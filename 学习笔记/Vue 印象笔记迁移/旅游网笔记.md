## 建立仓库

注册码云

创建远程仓库

![3.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746363461-77ee73dd-9dbc-44eb-b9d1-1cb9917af97c.jpeg)

![3 [1].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746357758-ce3429c1-0550-44a8-b370-44330805cb97.jpeg)

![3 [2].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746357843-4215b114-f9f3-494e-bd97-114bdddf8e12.jpeg)

![3 [3].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746357856-54cdedc1-3f28-415c-b4e6-c45be21d83d8.jpeg)

![3 [4].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746357925-8602f979-1e89-4482-bb51-d6d2afcdec72.jpeg)

生成公钥

![3 [5].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746358697-29553370-ff0e-4317-b4a3-8ba337da399d.jpeg)     

复制公钥                                                                   

![3 [6].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746358825-69d04dce-e63a-4230-9abb-8cfb551b39be.jpeg)

添加公钥

![3 [7].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746358834-d9190a4e-b0fb-448b-9d95-0406d4a9d1d9.jpeg)

复制仓库地址

![3 [8].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746358960-85b6c692-a176-48c5-b62b-28cf8cf3112b.jpeg)

cd Desktop

git clone + 仓库地址   把线上仓库项目克隆到本地，打通线上线下

## 创建 Vue 项目

（错误提示：没有node命令或vue命令）node 配置环境变量，cd Users/用户名 下安装vue cli：

```shell
npm install -g @vue/cli
```

检查其版本安装是否正确：

```sh
vue --version
```

vue init webpack hello-world 已经替换为 vue create hello-world

vue-cli 2.x  是被 vue-cli 3 覆盖的。如果你仍然需要使用旧版本的 vue init 功能还是可以实现的，只需要使用以下命令：

```sh
cd ~/Desktop

npm install -g @vue/cli-init

vue init webpack 项目名 （webpack是最流行的打包编译工具）
```

![3 [9].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746359272-2835e39f-8c2e-4947-8568-8154907e1c41.jpeg)

cd  项目名

npm run dev

显示 I Your application is running here: http://localhost:8081 后复制网址到浏览器打开

ctrl + c 退出项目

```sh
git status

git add .

git commit -m "project initialized"

git push
```

![3 [10].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746359646-97abac6a-06b3-4cf7-8e65-3a5838b32ca4.jpeg)

项目创建成功

## 项目结构

![3 [11].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746359688-be0da5a5-8d56-438a-a868-c776c79006c2.jpeg)
README.md      项目说明文件

package.json      依赖包

package-lock.json  依赖包真实版本，团队统一用

LICENCE     开源协议说明

index.html   项目模板文件

.postcsssrc.js  postcss的配置项

.gitignore git  上传仓库时配置忽略的文件

.eslintrc.js     检测代码是否规范

.eslintignore   不受eslint工具检测的文件夹和文件

.editorconfig   配置编辑器的语法，自动代码格式化

.babelrc       babel语法解析器，将vue单文件组件的es6代码转换成浏览器能编译执行的代码，可额外配置

static         放静态资源：如图片、模拟的JSON数据

node_modules  项目依赖的第三方包

src                   项目源代码

main.js               项目入口文件

APP.vue              项目最原始的根组件，.Vue代表它是单文件组件

router 的 index.js        项目所有的路由

components           项目用到的组件

assets                 项目图片资源

config                项目配置文件   

config 的 index.js        基础配置信息 

config 的dev.env.js       开发环境配置信息 

config 的prod.env.js      线上环境配置信息

build                  项目打包，webpack配置内容，包含基础webpack配置项 开发环境配置项 线上环境配置项

build 的 build.js         打包过程的额外webpack配置

build 的 utils.js           工具类

![3.png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746363698-1fc39877-ed08-4eab-8803-90d506256a6e.png)

![3 [1].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746357831-7c6b33c9-81f2-45fd-92a7-9feb0edbb986.png)

## 单文件组件与Vue中的路由

![3 [12].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746359758-9dd8d8ff-b6f9-4d94-9384-e3c4ca00a94b.jpeg)

main.js 入口文件

. 表示当前目录 ..表示父级目录

@表示src目录

```js
import Vue from 'vue'
import App from './App'       // .表示当前目录，引入名为APP的文件，其实就是引入APP.vue单文件组件，取名为APP模块变量
import router from './router' // 引入router文件夹（包含index.js文件），取名为router模块变量

new Vue({
  el: '#app',         // 定义了一个根实例，挂载到了index.html id为app的元素上
  router,             // 实际上是router: router，使用router模块变量 
  component: { APP }, // 实际上是APP: APP，使用APP模块变量，意思是项目用了一个局部组件叫APP，在外层new Vue()实例里这个组件也叫APP
  template: '<APP/>'  // 根实例渲染APP局部组件
})
```

index.html

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>travel</title>
  </head>
  <body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
```

APP.vue 根组件

单文件组件（.vue为后缀的文件），就是一个Vue组件，

它有三部分，组成了http://localhost:8081页面（不再是Vue.component的写法了）：

```vue
<template>
  <div id="app">
    <img src="./assets/logo.png">
    <!--显示的是当前路由地址所对应的的内容-->
    <router-view/>
  </div>
</template>

<script>
export default {
  name: 'App'
}
</script>

<style>
#app {
  font-family: 'Avenir', Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
```

![3 [13].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746359957-7828e0c8-5047-4114-8af6-2e4562567ddf.jpeg)

## 清理初始化项目

APP.vue  图片和样式清空：

```vue
<template>
  <div id="app">
    <!--显示的是当前路由地址所对应的的内容-->
    <router-view/>
  </div>
</template>

<script>
export default {
  name: 'App'
}
</script>

<style>
</style>
```

![3 [14].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746360265-719b38a7-1879-4bfd-b7d2-d488e330b8ac.jpeg)

APP.vue图片和样式已经删光了，为什么还有内容呢？

路由

路由就是根据网址（url）的不同，返回不同的内容给用户

APP.vue `<template>`里的 `<router-view/>`就是路由

`<router-view/>` 通过 main.js入口文件 的 import router from './router' （也就是router 文件夹的 index.js）引入：

```html
<！--显示的是 当前路由地址 http://localhost:8081/#/ 所对应的内容-—>
<router-view/>
```

![3 [15].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746360315-9c940e1f-195f-44e8-b857-023a2bb869ba.jpeg)

router 文件夹的 index.js中：

```js
import Vue from 'vue'
import Router from 'vue-router'
import HelloWorld from '@/components/HelloWorld'  // 引入src目录下components/HelloWorld 的HelloWorld组件

// 导出路由配置项
export default new Router({
  routes: [
    {
      path: '/',               // 当用户访问网址根路径时访问的是
      name: 'HelloWorld',
      component: HelloWorld    // 给用户展示的是HelloWorld组件
    }
])
```

src文件夹下components目录的

HelloWorld.vue

HelloWorld.vue也是单文件组件，也就是说 APP.vue `<template>`里的 `<router-view/>`展示的就是 HelloWorld.vue

1、HelloWorld.vue  

`<template>` 、`<style>`元素的所有内容和注释清空，`<script>`的data: {}清空：

```vue
<template>
    <h1>Hello World</h1>
</template>

<script>
   export default {
      name: 'HelloWorld'
   }
</script>

<style scoped>
</style>
```

APP.vue显示为：

![3 [16].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746360522-12d2d593-2b5c-4b04-b0f9-29d14b967ee4.jpeg)

3、删掉components 文件夹 和 HelloWorld.vue

4、删掉router 文件夹下 index.js 的 import HelloWorld from '@/components/HelloWorld'

5、router 的 index.js 第一次修改：

```js
import Vue from 'vue'
import Router from 'vue-router'

// 导出路由配置项
export default new Router({
  routes: [
    {
      path: '/',               // 当用户访问网址根路径时访问的是
      name: 'HelloWorld',
      component: HelloWorld    // 给用户展示的是HelloWorld组件，接下来要改为首页组件
    }
  ]
})
```

5、router 的 index.js 第二次修改：

routes属性用于展示多个路由（页面）组件

```js
import Vue from 'vue'
import Router from 'vue-router'
import Home from '@/pages/home/Home.vue'
import List from '@/pages/list/List.vue'

Vue.use(Router)

export default new Router({
  routes: [
    {
      path: '/',           
      name: 'Home',
      component: Home
    },
    {
      path: '/List',
      name: 'List',
      component: List
    }  
  ]
})
```

注意：routes 每个路由的path为访问网址时的路径

6、新建文件夹为pages，pages下新建目录为home并创建文件Home.vue

![3 [17].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746360934-20f4dfa3-0d9e-4476-9c8a-0e0e6115d274.jpeg)

Home.vue

```vue
<template>
    <div>home</div>
</template>

<script>
    export default {
        name: 'Home'
    }
</script>

<style>
</style>
```

7、pages文件夹下新建目录为list并创建文件List.vue

![3 [18].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746360977-932644d4-3fd3-4af2-a0d9-185acb52b5aa.jpeg)

List.vue

```vue
<template>
    <div>list</div>
</template>

<script>
    export default {
        name: 'List'
    }
</script>

<style>
</style>
```

小结

main.js => import App from './App' =>

APP.vue根组件 => `<router-view/>` => main.js => import router from './router' =>

router 文件夹的 index.js =>{ component} => import HelloWorld from '@/components/HelloWorld' => HelloWorld.vue

HelloWorld.vue => `<router-link>`（如果有） => `<router-view/>`

JS

```js
const Foo = { template: '<div>foo</div>' }
const Bar = { template: '<div>bar</div>' }

const routes = [
  { path: '/foo', component: Foo },
  { path: '/bar', component: Bar }
]

const router = new VueRouter({
  routes
})

const app = new Vue({
  router
}).$mount('#app')
```

HTML

```html
<router-link to="/foo">Go to Foo</router-link>
<router-link to="/bar">Go to Bar</router-link>

<router-view></router-view>
```

## 多页应用与单页应用

多页应用：每次跳转，后台都会返回一个新的HTML文件

![3 [19].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746361027-e276ceff-334e-47e4-a9fe-daccab5779a7.jpeg)

![3 [20].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746361084-8cc04ab6-d1d7-4434-accb-7cc343303671.jpeg)

![3 [21].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746361305-226d1761-944a-427c-9c42-73f70cf7d00f.jpeg)

![3 [22].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746361438-71543ef6-09c4-4cdb-963e-c71ee53ea3f6.jpeg)

优点一：访问页面时，服务器返回一个HTML，页面就展示出来，这个只经历一次HTTP请求

优点二：搜索引擎可以识别HTML内容，多个HTML文件有利于SEO排名靠前

缺点：请求一次页面就发一次HTTP请求，网络慢，HTTP请求就慢，页面切换慢

单页应用

`<router-link>`实现页面跳转

```vue
<template>
    <div>
        <div class="home">home</div>
        <router-link to="/list" class="home">列表</router-link>
    </div>
</template>

<script>
    export default {
        name: 'Home'
    }
</script>

<style>
    .home {
        font-size: 50px;
    }
</style>
```

进入首页，请求一个HTML文件：

![3 [23].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746361760-568c90e4-6457-4ec9-a53f-1fb86ba26185.jpeg)

跳转到列表页后，没有请求HTML文件：

![3 [24].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746361961-97affee8-14f1-4ded-9a54-92bd3c99e248.jpeg)

返回首页，也没有HTML文件：

![3 [25].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746362520-49fb2b21-8169-4b9c-9bdd-a3551d3cfdd9.jpeg)

![3 [26].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746362740-4178815b-4ed9-4a6b-b3e3-7c1aedb8bf51.jpeg)

单页应用可以在页面改变时，

或者说路由改变时，DOM 树只是改变它需要改变的部分，也就是动态改变当前的页面来与用户交互，而不需要重新加载整个页面

优点：页面跳转时不加载HTML文件，是靠JS感知URL变化，清除当前页面，渲染新页面的DOM结构，不用请求HTML文件

缺点一：单页应用首屏需要请求HTML文件，另外还要发一个JS请求，两个请求都响应了才能显示首页

缺点二：单页应用靠JS渲染页面，SEO排名效果差

通过服务器端渲染技术可以解决单页应用的两个缺点

## 项目代码初始化

index.html

加上视口：

```html
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
```

到网上搜索并下载reset.css

找到桌面的项目文件，删除assets文件夹下的 logo.png，新建styles文件夹，将reset.css放入styles文件夹

![3 [27].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746362826-b859b977-53cd-4009-baad-fc284bec580b.jpeg)

main.js 引入reset.css

```js
import Vue from 'vue'
import App from './App'
import router from './router'
import './assets/styles/reset.css'

Vue.config.productionTip = false

/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  render: h => h(App)
})
```

1像素边框问题：

1px在分辨率较高的多倍屏手机看起来很粗的现象

如border-bottom: 1px solid blue; 1px为CSS像素，在2倍屏、3倍屏里显示为2个或3个物理像素高度

解决方案：网上搜索下载border.css

main.js 引入border.css

```css
import './assets/styles/border.css'
```

300ms点击延迟问题：

click事件在某些机型上延迟300ms执行

解决方案：fastclick.js

```sh
ctrl + c 退出项目

npm install fastclick -- save
```

将fastclick引入到package.json的dependencies里

![3 [28].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746362904-35a3376c-29be-43c3-8617-7ad6affcf7cf.jpeg)

```sh
npm run start 重启项目
```

main.js 引入fastclick.js

```js
import fastClick from 'fastclick'

fastClick.attach(document.body)
```

main.js 

```js
import Vue from 'vue'
import App from './App'
import router from './router'
import fastClick from 'fastclick'

import './assets/styles/reset.css'
import './assets/styles/border.css'

Vue.config.productionTip = false
fastClick.attach(document.body)

/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  render: h => h(App)
})
```

删除List.vue

![3 [29].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746363195-77a9c768-b969-44ee-81dd-3a4c3bf17072.jpeg)

router 的 index.js 

```js
import Vue from 'vue'
import Router from 'vue-router'
import Home from '@/pages/home/Home.vue'

Vue.use(Router)

export default new Router({
  routes: [
    {
      path: '/',
      name: 'Home',
      component: Home
    }
  ]
})
```

删除Hello.vue冗余代码

Hello.vue

```vue
<template>
    <div>Hello World</div>
</template>

<script>
    export default {
        name: 'Home'
    }
</script>

<style>
</style>
```

## 阿里巴巴矢量图标库

登录Github账号

新建项目

![3 [30].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746363250-a63fb146-e20f-4865-8b7c-189c2fcbecdd.jpeg)

本地代码上传到码云的git仓库

```sh
git add .

git commit -m "project init"

git push
```

## 首页开发

### 首页Header

安装stylus（类似Sass的工具）

```sh
cd travel

npm install stylus --save

npm install stylus-loader --save
```

home文件夹下新建components文件夹，components文件夹下新建Header.vue

![3.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746415537-126b79e3-3762-462c-8d98-6de44d1f8ebd.jpeg)

Header.vue

```vue
<template>
    <div>this is Header</div>
</template>

<script>
    export default {
        name: 'HomeHeader'
    }
</script>

<style>
</style>
```

Home.vue引入Header.vue作为局部组件

Home.vue

```vue
<template>
    <home-header></home-header>
</template>

<script>
    import HomeHearder from './components/Header.vue'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder // ES6为什么不能用？
        }
    }
</script>

<style>
</style>
```

因为设计稿的宽度是 750px，所以给的是 iphone 6 的二倍图设计稿（iphone 6 的视口宽度为 375px）

![3 [1].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746412540-e1fbcf1a-261e-4dcd-9208-c12e181bbf45.jpeg)

将 reset.css 的 html元素 的 font-size设为50px，即 1rem = 50px 

使用rem布局转换时， 1px = 1 / 50px = .02rem

Header由三部分组成，量Header的高，量三部分的宽高，如：本来宽为64px，因为是二倍图（被放大了），所以：64px / 2 px = 32px = .64rem

![3 [2].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746412506-7ebd5026-3aed-4854-a7c8-8b27b20f4445.jpeg)

使用stylus，scoped限制样式只影响Header组件

Header.vue

```vue
<template>
    <div class="header">
        <div class="header-left">返回</div>
        <div class="header-input">输入城市/景点/主题</div>
        <div class="header-right">城市</div>
    </div>
</template>

<script>
    export default {
        name: 'HomeHeader'
    }
</script>

<style lang="stylus" scoped>
    .header
        display: flex
        line-height: .86rem
        background: #00bcd4
        color: #fff
        .header-left
            float: left
            width: .64rem
        .header-input
            flex: 1
            height: .64rem
            line-height: .64rem
            margin-top: .12rem
            margin-left: .2rem
            background: #fff
            border-radius: .1rem  
            color: #ccc
        .header-right
            float: right
            width: 1.24rem
            text-align: center
</style>
```

### iconfont的使用

去阿里巴巴矢量图标库 https://www.iconfont.cn下载字体图标

![3.png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746416502-2090c6e6-b60d-4195-a51d-6a2d59941f0b.png)

![3 [1].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746415558-5008e470-f3b0-4eef-a236-dde704a0cb56.png)

`&#xe624;`等是unicode编码

![3 [2].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746415607-30675b2f-d891-4fe0-9895-1c53a3209666.png)

剪切以下文件（iconfont.css、iconfont.svg、字体文件）

![3 [3].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746415660-2d9719be-cad4-4713-a757-f473ebf50fd1.png)

styles文件夹下新建iconfont

![3 [4].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746416126-97bc1cc4-a50e-4aea-90de-56c12ab2cb30.png)

iconfont.css

![3 [5].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746416220-d6d9eaf5-8d7c-47a2-9ceb-5cc08a98d403.png)

class="iconfont" 即可引用

```html
<div class="iconfont back-icon">&#xe624;</div>
```

### 代码优化

代码优化一

styles文件夹下新建variables.styl表示stylus的全局变量

（作用：例如存储背景颜色值为全局变量，修改变量就改变所有应用该变量的页面的背景颜色）

```stylus
$bgColor = #00bcd4
```

使用快捷方式修改文件路径的书写：

![3 [6].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746416453-c5cb1697-583f-445b-8e96-1c237671af0c.png?x-oss-process=image%2Fresize%2Cw_929%2Climit_0)

改了webpack配置要：

```sh
ctrl + c 退出项目

npm run start 重启项目（服务器）
```

代码优化二

不想让引入路径太长

```js
@import '../../../assets/styles/variables.styl'
```

Header.vue

```vue
<template>
    <div class="header">
        <div class="header-left">
            <div class="iconfont back-icon">&#xe624;</div>  
        </div>
        <div class="header-input">
            <span class="iconfont">&#xe632;</span>
            输入城市/景点/主题
        </div>
        <div class="header-right">
            城市
            <span class="iconfont arrow-icon">&#xe64a;</span>
        </div>
    </div>
</template>

<script>
    export default {
        name: 'HomeHeader'
    }
</script>

<style lang="stylus" scoped>
@import '~styles/assets/styles/variables.styl' /* <style> 的 import 前面需要加 @ ，引入路径要以 ~ 开头 */
    .header
        line-height: .86rem
        display: flex
        background: $bgColor
        color: #fff
        .header-left
            float: left
            width: .64rem
            .back-icon
                text-align: center
                font-size: .4rem
        .header-input
            flex: 1
            height: .64rem
            line-height: .64rem
            margin-top: .12rem
            margin-left: .2rem
            padding-left: .2rem
            background: #fff
            border-radius: .1rem  
            color: #ccc
        .header-right
            float: right
            width: 1.24rem
            text-align: center
            .arrow-icon
                font-size: .24rem
                margin-left: -.04rem
</style>
```

@import '~styles/assets/styles/variables.styl'

文件路径前面加 ~ 表示你后面的值为 alias,，它会去 webpack alias 配置中找相应的值, 然后拼接成最后的地址

![3 [7].png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746416585-a0b7c8fe-c80c-4ca0-a317-8382d1e80a4c.png?x-oss-process=image%2Fresize%2Cw_929%2Climit_0)

![3 [3].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746412516-6f62a7dc-fb80-481f-be8e-f45cfdd43e02.jpeg)

ctrl + c 退出项目

再次提交代码

```sh
git add .

git commit -m 'add header'

git push
```

Writing objects 100%即成功

### 首页轮播图

企业级别的开发：每开发一个功能会创建一个git分支，代码开发完成后会合并到master主分支

打开码云项目仓库，创建分支

![3 [4].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746412517-be7d81b5-e288-451d-8f7d-acf543dd060f.jpeg)

![3 [5].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746412513-02762de4-5ec1-4cfe-b45f-6363f9996722.jpeg)

把线上分支index-swiper拉到本地

```sh
cd travel

git pull

git checkout index-swiper

git status // 查看当前分支
```

ctrl + c 退出项目

安装第三方插件

```sh
npm install vue-awesome-swiper@2.6.7 --save
```

npm run start 重启项目（服务器）

因为每个页面都可能要用轮播图，怎样让全局使用vue-awesome-swiper呢：

https://github.com/surmon-china/vue-awesome-swiper

![3 [6].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746413124-d69d222a-3d56-41fd-8449-d6494c248b98.jpeg)

打开src文件夹下的main.js，复制粘贴 引入 和 使用

main.js

```js
import Vue from 'vue'
import App from './App'
import router from './router'
import fastClick from 'fastclick'
import 'styles/reset.css'
import 'styles/border.css'
import 'styles/iconfont.css'
import VueAwesomeSwiper from 'vue-awesome-swiper'
import 'swiper/dist/css/swiper.css'

Vue.config.productionTip = false
fastClick.attach(document.body)
Vue.use(VueAwesomeSwiper)

/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  render: h => h(App)
})
```

打开pages文件夹下的home的components文件再创建一个组件为HomeSwiper.vue

复制以下代码：

![3 [7].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746413249-a5427d82-85be-4b40-b512-9f77df9fd0ab.jpeg)

HomeSwiper.vue

去除多余的轮播图片、箭头和滚动条等

```vue
<template>
  <swiper :options="swiperOption">
    <!-- slides -->
    <swiper-slide>I'm Slide 1</swiper-slide>
    <swiper-slide>I'm Slide 2</swiper-slide>

    <div class="swiper-pagination" slot="pagination"></div>
  </swiper>
</template>
<script>
export default {
    name: 'HomeSwiper',
    data() {
        return {
            swiperOption: {}
        }
    }
}
</script>

<style lang="stylus" scoped>
</style>
```

Home.vue

```vue
<template>
    <div>
        <home-header></home-header>
        <home-swiper></home-swiper>
    </div>    
</template>

<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper
        }
    }
</script>

<style>
</style>
```

复制去哪儿网http://piao.qunar.com/touch/的图片地址

```vue
   <swiper-slide>
        <img class="swiper-img" src="http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/201911/15f7901482e5a0b40d5cc8d38ce1dbae.jpg_750x200_033a5b46.jpg"/>
    </swiper-slide>
    <swiper-slide>
        <img  class="swiper-img" src="http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/201911/f74957827d190508c2598fb79ec36102.jpg_750x200_2960f17f.jpg"/>
    </swiper-slide>
```

**页面抖动问题**

![3 [8].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746413422-bc1916c7-9b3c-4c75-a6cb-217014b87ece.jpeg)

![3.gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746613387-b160d229-1729-49f8-9807-0e7b1e51dfd9.gif)

小tips：VSCode快捷键 Ctrl + [ 和 Ctrl + ] 左右缩进

原因：

如果网络慢，图片加载会很慢，在DOM结构渲染完成时，img图片尚未加载，此时我们并不知道图片的宽高比，高度会默认为0，文本在上面

当图片加载完成后，已经知道图片的信息了，会重新计算，并进行重绘，文本会下移

页面抖动解决方案

图片高宽比自适应

padding-bottom = 高 / 宽 = 200 / 750 = 26.7%

给图片高度初始化为0，当图片尚未加载时，就用padding来撑开高度，骗浏览器假装高度不是0，不要把文本下移了！

```vue
<template>
    <div class="wrapper">
        <swiper :options="swiperOption">
            <!-- slides -->
            <swiper-slide v-for="item of swiperList" :key="item.id">
                <img  class="swiper-img" :src="item.imgUrl"/>
            </swiper-slide>
            <div class="swiper-pagination"  slot="pagination"></div>
        </swiper>
    </div>
</template>
```

```stylus
.wrapper
    width: 100%
    height: 0
    padding-bottom: 26.7%
    .swiper-img
      width: 100%
```

![3 [1].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746611604-a02658ca-bdc4-4902-9e0a-07ea33f782b1.gif)

问题：无法给swiper组件应用样式，设置轮播图小点的颜色

解决方案：样式穿透  （sass/scss/less 之类的预处理器无法正确解析 >>> ，需要使用 /deep/ 选择器。）

```js
swiperOption: {
    pagination: '.swiper-pagination'
}
```

```stylus
.wrapper >>> .swiper-pagination-bullet-active
    background: #fff
```

Swiper.vue

```vue
<template>
    <div class="wrapper">
        <swiper :options="swiperOption">
            <!-- slides -->
            <swiper-slide v-for="item of swiperList" :key="item.id">
                <img class="swiper-img" :src="item.imgUrl"/>
            </swiper-slide>
            <div class="swiper-pagination"  slot="pagination"></div>
        </swiper>
    </div>
</template>

<script>
    export default {
        name: 'HomeSwiper',
        data () {
            return {
                swiperOption: {
                    pagination: '.swiper-pagination',
                    loop: true,
                    autoplay: 5000,
                    observer:true,//修改swiper自己或子元素时，自动初始化swiper
                    observeParents:true//修改swiper的父元素时，自动初始化swiper  
                },
                swiperList: [{
                    id: '01',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/201911/15f7901482e5a0b40d5cc8d38ce1dbae.jpg_750x200_033a5b46.jpg'
                }, {
                    id: '02',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/201911/f74957827d190508c2598fb79ec36102.jpg_750x200_2960f17f.jpg'
                }, {
                    id: '03',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/201911/bbe7e1932d46f0480c9d9a5db18862b9.jpg_750x200_22c82912.jpg'
                }, {
                    id: '04',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/201911/14c86b17f55e4b639776b497178f8ef7.jpg_750x200_0d6b121a.jpg'
                }]
            }
        }
    }
</script>

<style lang="stylus" scoped>
    .wrapper >>> .swiper-pagination-bullet-active
        background: #fff
    .wrapper
        width: 100%
        height: 0
        padding-bottom: 26.7%
        .swiper-img
          width: 100%     
</style>
```

轮播图的点就出来了

![3 [2].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746611522-90932951-5514-4fd0-8313-0f67920d79dd.gif)

提交代码到index-swiper分支，切换回master，再合并分支

```sh
git add .

git commit -m 'change'

git push

git checkout master

git merge origin/index-swiper

git push
```

首页图标区域页面布局

新建git分支为index-icons，把分支拉到本地

```sh
cd travel

git pull

git checkout index-icons
```

home文件夹下的components文件夹新建

![3 [9].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746413436-c5f42e0f-ea12-4ef4-a695-6e21675c665f.jpeg)

Icons.vue

```vue
<template>
    <div>icons</div>
</template>

<script>
export default {
    name: 'HomeIcons'
}
</script>

<style lang="stylus" scoped>
</style>
```

Home.vue 引入 Icons.vue 组件

```vue
<template>
    <div>
        <home-header></home-header>
        <home-swiper></home-swiper>
        <home-icons></home-icons>
    </div>    
</template>

<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons
        }
    }
</script>

<style>
</style>
```

Icons.vue

```vue
<template>
    <div class="icons">
        <div class="icon">
            <div class="icon-content">
                <img class="icon-img" src="http://img1.qunarzz.com/piao/fusion/1803/95/f3dd6c383aeb3b02.png"/>
                <div class="keyword">景点门票</div>   
            </div>
        </div>
        <div class="icon">
            <div class="icon-content">
                <img class="icon-img" src="http://img1.qunarzz.com/piao/fusion/1803/95/f3dd6c383aeb3b02.png"/>
                <div class="keyword">景点门票</div>   
            </div>
        </div>
        ...                                                 
    </div>
</template>

<script>
    export default {
        name: 'HomeIcons'
    }
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
    .icons
        height: 0
        padding-bottom: 50%
        overflow: hidden
        .icon
            position: relative
            float: left
            width: 25%
            padding-bottom : 25%
            text-align: center  
            color: $darkColor
            font-size: .28rem  
            .icon-content
                position: absolute
                top: .10rem
                left: 0
                right: 0
                bottom: .44rem
                box-sizing: border-box
                padding: .1rem
                .icon-img
                    height: 100%
                .keyword
                    margin-top: .1rem                        
</style>
```

![3 [3].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746611445-108099d9-d804-476f-9f03-4ff8375aadef.gif)

### 图标区域逻辑实现

```vue
<template>
    <div class="icons">
        <swiper>
            <swiper-slide>
                <div class="icon">
                    <div class="icon-content">
                        <img class="icon-img" src="http://img1.qunarzz.com/piao/fusion/1803/95/f3dd6c383aeb3b02.png"/>
                        <div class="keyword">景点门票</div>   
                    </div>
                </div>
            </swiper-slide>
            <swiper-slide>
                <div class="icon">
                    <div class="icon-content">
                        <img class="icon-img" src="http://img1.qunarzz.com/piao/fusion/1803/95/f3dd6c383aeb3b02.png"/>
                        <div class="keyword">景点门票</div>   
                    </div>
                </div>
            </swiper-slide>  
        </swiper>                                              
    </div>
</template>
```

![3 [4].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746611618-755da4a5-6ad3-4241-b87e-3eb34defedc9.gif)

问题：.icons区域中只有.icon图标部份才能拖动图标，下部份无法拖动图标

原因：swiper-container高度只有图标高度这么高

![3 [10].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746413923-ed9c35cc-08cc-4b4a-ac8c-4f06a95d0d71.jpeg)

解决方案：样式穿透，.swiper-container自带overflow: hidden所以就不写了

```stylus
.icons >>> .swiper-container
    height: 0
    padding-bottom: 50%  
```

循环图标区域数据展示 

```vue
<template>
    <div class="icons">
        <swiper>
            <swiper-slide>
                <div class="icon" v-for="item of iconsList" :key="item.id">
                    <div class="icon-content">
                        <img class="icon-img" :src="item.imgUrl"/>
                        <div class="keyword">{{item.keyword}}</div>   
                    </div>
                </div>
            </swiper-slide>
        </swiper>                                              
    </div>
</template>

<script>
    export default {
        name: 'HomeIcons',
        data () {
            return {
                iconsList: [{
                    id: '01',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1803/95/f3dd6c383aeb3b02.png',
                    keyword: '景点门票'
                }, {
                    id: '02',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1804/ff/fdf170ee89594b02.png',
                    keyword: '广州必游'
                }, {
                    id: '03',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1803/fa/2548667cb6e902.png',
                    keyword: '动植物园'
                }, ...]
            }
        }
    }
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'
    .icons >>> .swiper-container
        height: 0
        padding-bottom: 50%       
    .icon
        position: relative
        float: left
        width: 25%
        padding-bottom : 25%
        color: $darkColor
        font-size: .28rem  
        text-align: center  
        .icon-content
            position: absolute
            top: .10rem
            left: 0
            right: 0
            bottom: .44rem
            box-sizing: border-box
            padding: .1rem
            .icon-img
                height: 100%
            .keyword
                margin-top: .1rem                        
</style>
```

![3 [11].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746414050-4439d985-a3bf-4109-b395-0614ed68807c.jpeg?x-oss-process=image%2Fresize%2Cw_868%2Climit_0)

问题：v-for之后第二页的图标元素被隐藏了，无法显示两页

解决方案：使用计算属性把 一维数组 iconsList [0, 1, 2, ..., 8] 拆分为 二维数组 [[第一页8条数据], [第二页1条数据]] 里面的每个数组最多只能容纳8条数据

```js
computed: {
     pages () {
         const pages = []
         this.iconsList.forEach((item, index) => {
             // 根据数组的index分页，只有index >= 8了，Math.floor()才会返回大于0的整数，比如1.每页只能容纳8条数据
             const page = Math.floor(index / 8); 
             // 如果第n页还没有第一条数据
             if (!pages[page]) {
                 pages[page] = []
             }
             // 每页数据分组推入
             pages[page].push(item)
        })
        return pages
    }
}
```

![3 [12].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746413978-d25b46ad-3af7-4b6a-868e-6b3839ed5d89.jpeg)

![3 [13].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746414587-15179301-8c60-4de5-ae99-e968896b7b28.jpeg)

styles文件夹下新建mixins.styl封装文本截断样式，在Icons.vue里应用给图标下面的关键词

```stylus
ellipsis()
    overflow: hidden
    white-space: nowrap
    text-overflow: ellipsis
```

根据数据项的不同自动显示一页或多页切换

```vue
<template>
    <div class="icons">
        <swiper :options="swiperOption">
            <swiper-slide v-for="(page, index) of pages" :key="index">
                <div class="icon" v-for="item of page" :key="item.id">
                    <div class="icon-content">
                        <img class="icon-img" :src="item.imgUrl"/>
                        <div class="keyword">{{item.keyword}}</div>   
                    </div>
                </div>
            </swiper-slide>
        </swiper>                                              
    </div>
</template>

<script>
    export default {
        name: 'HomeIcons',
        data () {
            return {
                swiperOption: {
                    autoplay: false
                },
                iconsList: [{
                    id: '01',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1803/95/f3dd6c383aeb3b02.png',
                    keyword: '景点门票'
                }, {
                    id: '02',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1804/ff/fdf170ee89594b02.png',
                    keyword: '广州必游'
                }, {
                    id: '03',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1803/fa/2548667cb6e902.png',
                    keyword: '动植物园'
                }, {
                    id: '04',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/20193/a40ee278d67000f2a29d2e20f6a029b3.png',
                    keyword: '自然风光'
                }, {
                    id: '05',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1804/5a/13ceb38dcf262f02.png',
                    keyword: '一日游'
                }, {
                    id: '06',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1803/ab/6f7d6e44963c9302.png',
                    keyword: '泡温泉'
                }, {
                    id: '07',
                    imgUrl: 'http://img1.qunarzz.com/piao/fusion/1803/50/26ffa31b56646402.png',
                    keyword: '亲子游'
                }, {
                    id: '08',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/20193/184e261814a5d07a5d3d08cd29cf590d.png',
                    keyword: '长隆度假区'
                }, {
                    id: '09',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/20193/c032ae43b15a3dac34b5e07bb0e46850.png',
                    keyword: '广州塔'
                }, {
                    id: '10',
                    imgUrl: 'http://mp-piao-admincp.qunarzz.com/mp_piao_admin_mp_piao_admin/admin/20194/bda58ffc3016edad84e656e8a94b0321.png',
                    keyword: '广州融创'
                }]
            }
        },
        computed: {
            pages () {
                const pages = []
                this.iconsList.forEach((item, index) => {
                    const page = Math.floor(index / 8);
                    if (!pages[page]) {
                        pages[page] = []
                    }
                    pages[page].push(item)
                })
                return pages
            }
        }
    }
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'
    @import '~styles/mixins.styl'
    .icons >>> .swiper-container
        height: 0
        padding-bottom: 50%       
    .icon
        position: relative
        float: left
        width: 25%
        padding-bottom : 25%
        color: $darkColor
        text-align: center  
        .icon-content
            position: absolute
            top: .10rem
            left: 0
            right: 0
            bottom: .44rem
            padding: .1rem
            .icon-img
                height: 100%
            .keyword
                margin-top: .1rem  
                ellipsis()                        
</style>
```

`<swiper>`组件默认自动轮播，需要设置关闭，代码如下：

```js
data () {
    return {
        swiperOption: {
            pagination: '.swiper-pagination',
            autoplay: false,
            observer:true,//修改swiper自己或子元素时，自动初始化swiper
            observeParents:true//修改swiper的父元素时，自动初始化swiper
        }
    }
}
```

![3 [5].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746611672-ab525396-98bf-4d67-ae58-440da86a418f.gif)

ctrl + c 退出项目

再次提交

```sh
git add .

git commit -m 'add icons'

git push

git checkout master

git merge origin/index-icons

git push
```

### 推荐组件开发

新建git分支为index-recommend，把分支拉到本地

```sh
cd travel

git pull

git checkout index-recommend
```

去哪儿网http://piao.qunar.com/touch/的猜你喜欢

在pages文件夹下的componnents文件夹下新建HomeRecommend.vue组件

HomeRecommend.vue

```vue
<template>
    <div>猜你喜欢</div>
</template>

<script>
    export default {
        name: 'HomeRecommend'
    }
</script>

<style lang="stylus" scoped>
    
</style>
```

Home.vue

```vue
<template>
    <div>
        <home-header></home-header>
        <home-swiper></home-swiper>
        <home-icons></home-icons>
        <home-recommend></home-recommend>
    </div>    
</template>

<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    import HomeRecommend from './components/Recommend.vue'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend
        }
    }
</script>
```

1px解决方案（引入border.css）

类名添加border-bottom

```html
<li class="item border-bottom">
```

文本截断省略号解决方案

```stylus
.item-info
     flex: 1
     padding: .1rem
     min-width: 0
     .item-title
          font-size: .32rem
          line-height: .54rem
          ellipsis()
     .item-desc
          line-height: .4rem
          color: #ccc  
          ellipsis()
```

Recommend.vue

```vue
<template>
<div class="group">
    <div class="group-title">
        <img class="title-img" alt="猜你喜欢" src="http://img1.qunarzz.com/piao/fusion/1711/89/ebc329f16c55bb02.png"/>
        <span class="title">猜你喜欢</span>
    </div>
    <ul>
        <li class="item border-bottom" v-for="item of recommendList" :key="item.id">
            <img class="item-img" :src="item.imgUrl"/>
            <div class="item-info">
                 <p class="item-title">{{item.title}}</p>
                 <p class="item-desc">{{item.desc}}</p>
                 <button class="item-button">查看详情</button>
            </div>
        </li>
    </ul>
</div>  
</template>

<script>
    export default {
        name: 'HomeRecommend',
        data () {
            return {
                recommendList: [{
                    id: '01',
                    imgUrl: 'http://img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_200x200_4f9d01ca.jpg',
                    title: '南沙湿地公园',
                    desc: '广州最大的湿地公园'
                }, {
                    id: '02',
                    imgUrl: 'http://img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_200x200_4f9d01ca.jpg',
                    title: '南沙湿地公园',
                    desc: '广州最大的湿地公园'
                }, {
                    id: '03',
                    imgUrl: 'http://img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_200x200_4f9d01ca.jpg',
                    title: '南沙湿地公园',
                    desc: '广州最大的湿地公园'
                }]
            }           
        }
    }
</script>

<style lang="stylus" scoped>
@import '~styles/mixins.styl'
    .group
        margin-top: .2rem
        .group-title
            padding: .24rem 0 .26rem
            font-size: .24rem
            .title-img
                width: .3rem
                height: .3rem
                margin-left: .2rem
                overflow: hidden
                vertical-align: top
            .title
                display: inline-block
                color: #212121
                margin-left: .08rem
                font-size: .32rem
                line-height: .44rem              
        .item
            display: flex
            height: 2rem
            padding: .2rem 0
            margin-left: .24rem
            overflow: hidden
            .item-img
                width: 2rem
                height: 2rem
            .item-info
                flex: 1
                padding: .1rem
                .item-title
                    font-size: .32rem
                    line-height: .54rem
                    ellipsis()
                .item-desc
                    line-height: .4rem
                    color: #f55  
                    ellipsis()
                .item-button
                    background: #ff9300
                    line-height: .44rem
                    margin-top: .16rem
                    padding: 0 .2rem
                    border-radius: .06rem
                    color: #fff                 
</style>
```

![3 [6].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746612420-0f4f86ca-ce35-4b2b-861b-9ada78489be2.gif)

### 周末游组件开发

周末游组件与推荐组件类似，所以主要是改weekend-title样式和图片

```stylus
.item-imgcontainer
    height: 0
    padding-bottom: 37.435%
    overflow: hidden                
    .item-img
        width: 100%
```

在pages文件夹下的componnents文件夹下新建HomeWeekend.vue组件

Home.vue

```vue
<template>
    <div>
        <home-header></home-header>
        <home-swiper></home-swiper>
        <home-icons></home-icons>
        <home-recommend></home-recommend>
        <home-weekend></home-weekend>
    </div>    
</template>

<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    import HomeRecommend from './components/Recommend.vue'
    import HomeWeekend from './components/Weekend.vue'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend,
            HomeWeekend: HomeWeekend
        }
    }
</script>
```

Weekend.vue

```vue
<template>
<div class="group">
    <div>
        <h2 class="weekend-title">周末去哪儿</h2>
    </div>
    <ul>
        <li class="border-bottom" v-for="item of recommendList" :key="item.id">
            <div class="item-imgcontainer">
                <img class="item-img" :src="item.imgUrl"/>
            </div>
            <div class="item-info">
                 <p class="item-name">{{item.title}}</p>
                 <p class="item-desc">{{item.desc}}</p>
            </div>
        </li>
    </ul>
</div>  
</template>

<script>
    export default {
        name: 'HomeWeekend',
        data () {
            return {
                recommendList: [{
                    id: '01',
                    imgUrl: 'http://img1.qunarzz.com/sight/source/1811/15/66f14e0fd6fbb.jpg_r_640x214_5d69f21d.jpg',
                    title: '清远周边逛',
                    desc: '人人都有一双发现美的眼睛，身边的事物最熟悉不过，那你可曾发现了被人遗漏的美？'
                }, {
                    id: '02',
                    imgUrl: 'http://img1.qunarzz.com/sight/source/1811/15/66f14e0fd6fbb.jpg_r_640x214_5d69f21d.jpg',
                    title: '清远周边逛',
                    desc: '人人都有一双发现美的眼睛，身边的事物最熟悉不过，那你可曾发现了被人遗漏的美？'
                }, {
                    id: '03',
                    imgUrl: 'http://img1.qunarzz.com/sight/source/1811/15/66f14e0fd6fbb.jpg_r_640x214_5d69f21d.jpg',
                    title: '清远周边逛',
                    desc: '人人都有一双发现美的眼睛，身边的事物最熟悉不过，那你可曾发现了被人遗漏的美？'
                }]
            }           
        }
    }
</script>

<style lang="stylus" scoped>
@import '~styles/mixins.styl'
        .weekend-title
            height: .8rem
            padding-left: .26rem
            line-height : .8rem
            color: #212121
        .item-imgcontainer
            height: 0
            padding-bottom: 37.435%
            overflow: hidden                
            .item-img
                width: 100%
        .item-info
            position: relative
            padding: .14rem .2rem .2rem .2rem        
            .item-name
                padding-right: 1.4rem
                color: #212121
                font-size: .28rem
                line-height: .48rem
                ellipsis()
            .item-desc
                padding-right: 1.4rem
                color: #616161
                font-size: .24rem
                line-height: .42rem;
                ellipsis()                 
</style>
```

![3 [7].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746613121-4de2ad4a-8927-4c27-9803-b293a30a729e.gif)

ctrl + c 退出项目

再次提交代码

```sh
git add .

git commit -m 'add recommned'

git push
```

注意：

```vue
<swiper :options="swiperOption">
            <!-- slides -->
            <swiper-slide v-for="item of swiperList" :key="item.id">
                <img  class="swiper-img" :src="item.imgUrl"/>
            </swiper-slide>
            <div class="swiper-pagination"  slot="pagination"></div>
</swiper>
```

 `<swiper>`中的slot="pagination"插槽让组件的一部分内容可以被父组件定制，slot负责传可以被定制的内容

补充：

![3 [14].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746414650-068ddca2-cf77-4c6b-a954-f972f95cb9c1.jpeg)

¥270 和 广州长隆 用`<div>`包裹并用margin-top拉开距离

¥270 和 起 只是字体大小和颜色不同

评论数设置为

```stylus
.mp-comment-num {
    color: #616161;
    font-size: .24rem;
    line-height: .34rem;
    vertical-align: text-bottom
}
```

利用子绝父相将 广州长隆 放右边

星级图标的思路是引入字体图标再用 letter-spacing拉开距离 transform 缩放比例 z-index覆盖颜色

gain为获得星数（橙色），total为总星数（灰色）

```stylus
starlevel {
    display: inline-block;
    width: 1.5rem;
    height: .28rem;

    letter-spacing: .02rem;

    -webkit-transform: scale(.83);
    -moz-transform: scale(.83);
    -ms-transform: scale(.83);
    -o-transform: scale(.83);
    transform: scale(.83);

    -webkit-transform-origin: 0 0;
}

starlevel-gain, starlevel-total {
    position: absolute;
    top: .04rem;
    left: 0;
    height: .28rem
}

starlevel-gain {
    z-index: 2;
    color: #ffb436;
}
starlevel-total {
    z-index: 1;
    color: #e0e0e0;
}
```

Recommend.vue 最终版

```vue
<template>
<div class="group">
    <div class="group-title">
        <img class="title-img" alt="猜你喜欢" src="http://img1.qunarzz.com/piao/fusion/1711/89/ebc329f16c55bb02.png"/>
        <span class="title">猜你喜欢</span>
    </div>
    <ul>
        <router-link
           tag="li"
           class="item border-bottom"
           v-for="item of list"
           :key="item.id"
           :to="'/detail/' + item.id">
            <img class="item-img" :src="item.imgUrl"/>
            <div
            class="item-tag"
            style="background-image:url(https://img1.qunarzz.com/piao/fusion/1802/52/b9080e45b69b4f02.png)">
            可订明日
            </div>
            <div class="item-info">
                 <p class="item-title">{{item.title}}</p>
                 <div class="item-comment">
                     <span class="starLevel">
                         <strong class="iconfont starLevel-total">&#xe613;&#xe613;&#xe613;&#xe613;&#xe613;</strong>
                     </span>
                     <span class="comment-num">13016条评论</span>
                 </div>
                 <div class="item-price">
                       <span class="price">
                           ¥<em class="price-num">88</em>
                       </span>
                        起
                       <span class="address">番禺区</span>
                 </div>
                 <div class="item-detail">
                       <p class="item-desc">{{item.desc}}</p>                           
                       <button class="item-button">查看详情</button>
                 </div>                
            </div>
        </router-link>
    </ul>
</div>  
</template>
<script>
    export default {
        name: 'HomeRecommend',
        props: {
            list: Array
        }
    }
</script>
<style lang="stylus" scoped>
@import '~styles/mixins.styl'
    .group
        margin-top: .2rem
        background: #fff
        .group-title
            padding: .24rem 0 .26rem
            font-size: .24rem
            .title-img
                width: .3rem
                height: .3rem
                margin-left: .2rem
                overflow: hidden
                vertical-align: top
            .title
                display: inline-block
                color: #212121
                margin-left: .08rem
                font-size: .32rem
                line-height: .44rem              
        .item
            position: relative
            display: flex
            padding: .2rem 0
            margin-left: .24rem
            overflow: hidden   
            .item-img
                width: 2rem
                height: 2rem
            .item-tag               
                position: absolute
                top: .2rem
                left: 0
                width: 1.02rem
                height: .38rem
                background-size: 100%
                color: #fff
                font-size: .2rem
                line-height: .38rem
                text-indent: .04rem                           
            .item-info
                flex: 1
                padding-left: .22rem
                min-width: 0
                .item-title
                    font-size: .32rem
                    line-height: .54rem
                    ellipsis()
                .item-comment
                    margin-top: .14rem
                    height: .34rem
                    .starLevel
                        display: inline-block
                        position: relative
                        width: 1.5rem
                        height: .28rem
                        letter-spacing: .02rem
                        transform: scale(.83)
                        -webkit-transform-origin: 0 0  
                        .starLevel-total
                             overflow: hidden
                             position: absolute
                             top: .04rem
                             left: 0
                             height: .28rem   
                             z-index: 1
                             color: #ffb436
                    .comment-num
                        color: #616161
                        font-size: .24rem
                        line-height: .34rem
                        vertical-align: text-bottom  
                .item-price
                    position: relative
                    margin-top: .22rem
                    color: #616161
                    font-size: .24rem
                    line-height: .4rem
                    .price
                        color: #ff8300   
                        .price-num
                            font-size: .4rem
                    .address
                        position: absolute
                        right: .24rem
                        bottom: 0    
                .item-detail
                    position: relative                    
                    .item-desc
                        display: inline-block
                        margin-top: .2rem
                        margin-right: .24rem
                        padding: .04rem .1rem
                        font-size: .24rem
                        line-height: .34rem
                        color: #f55  
                        background: #fff9f9
                        ellipsis()
                    .item-button
                        position: absolute
                        right: .24rem
                        bottom: .1rem
                        background: #ff9300
                        font-size: .24rem
                        line-height: .34rem
                        margin-top: .2rem
                        padding: .04rem .1rem
                        border-radius: .06rem
                        color: #fff
        .border-bottom::before
            border-bottom: 1px solid #e0e0e0                  
</style>
```

![3 [8].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746613732-1f75d1a4-44b1-4ce8-8ec0-06fbb3f9cac2.gif)

### Ajax获取首页数据

创建分支 index-ajax，把分支拉到本地

```sh
cd travel

git pull

git checkout index-ajax

git merge index-recommend
```

Ajax工具有很多：浏览器自带fetch、Vue 以前推荐 vue-resource 第三方模块，现在推荐 axios 第三方模块

安装 axios 第三方模块，并启动项目服务器

```sh
npm install axios --save

npm run start
```

每个组件都要发Ajax请求数据的话，性能低

Home.vue 发送Ajax请求

```vue
<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    import HomeRecommend from './components/Recommend.vue'
    import HomeWeekend from './components/Weekend.vue'
    import axios from 'axios'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend,
            HomeWeekend: HomeWeekend
        },
        methods: {
            getHomeInfo () {
                axios.get('/api/index.json')
                    .then(this.getHomeInfoSucc)
            },
            getHomeInfoSucc (res) {
                console.log(res)
            }
        },
        mounted () {
            this.getHomeInfo()
        }
    }
</script>
```

![3 [15].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746414749-797e455a-aaf1-4703-ab4c-b47866972937.jpeg)

问题：

没有后端支持，怎么模拟数据？

在static文件夹下新建mock文件夹并创建index.json文件（工程中只有static文件夹的文件可以被外部访问，其他文件夹会被回退到首页）

注意：要在gitignore里添加下面的路径，mock才不会被提交到本地git和远程仓库上

```
static/mock
```

Home.vue

```vue
<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    import HomeRecommend from './components/Recommend.vue'
    import HomeWeekend from './components/Weekend.vue'
    import axios from 'axios'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend,
            HomeWeekend: HomeWeekend
        },
        methods: {
            getHomeInfo () {
                axios.get('/static/mock/index.json')
                    .then(this.getHomeInfoSucc)
            },
            getHomeInfoSucc (res) {
                console.log(res)
            }
        },
        mounted () {
            this.getHomeInfo()
        }
    }
</script>
```

![3 [16].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746415080-64e56829-fc92-4107-ae0d-2f7558e0f86d.jpeg)

代码上线不能使用本地模拟的接口地址， 

代码上线前需要改成 /api/index.json 的格式，需要使用Vue的代理把对 /api/index.json 的所有的请求转发到本地的mock文件夹下

打开config文件夹下的index.js，使用代理 proxyTable 转发请求

```js
proxyTable: {
        '/api': {
            target: 'http://localhost:8081',
            pathRewrite: {
                '^/api': '/static/mock'
            }
        }
}
```

实际这个功能是webpack-dev-server提供的，而不是Vue

```js
axios.get('/static/mock/index.json')
```

再次修改为：

```js
axios.get('/api/index.json')
```

重启项目：

```sh
ctrl + c

npm run start
```

### 首页父子组件传值

Home.vue

```vue
export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend,
            HomeWeekend: HomeWeekend
        },
        data () {
            return {
                swiperList: []
            }
        },
        methods: {
            getHomeInfo () {
                axios.get('/api/index.json')
                    .then(this.getHomeInfoSucc)
            },
            getHomeInfoSucc (res) {
                res = res.data
                if (res.ret && res.data) {
                    const data = res.data
                    this.swiperList = data.swiperList
                }
            }
        },
        mounted () {
            this.getHomeInfo()
        }
}
```

```vue
<home-swiper :list="swiperList"></home-swiper>
```

Swiper.vue

```vue
export default {
     name: 'HomeSwiper',
     props: {
         list: Array
     },
     data () {
         return {
             swiperOption: {
                 pagination: '.swiper-pagination',
                 loop: true,
                 autoplay: 5000
             }
         }
     }
}
```

```vue
<swiper :options="swiperOption">
            <!-- slides -->
            <swiper-slide v-for="item of list" :key="item.id">
                <img class="swiper-img" :src="item.imgUrl"/>
            </swiper-slide>
            <div class="swiper-pagination"  slot="pagination"></div>
</swiper>
```

问题：

轮播图默认显示第四张图

原因：

一开始props 接收的是swiperList: []，swiper是空数组创建的

当ajax获取数据完成后，swiper才获取到新数据，重新渲染获得的所有轮播图幻灯片

解决方案：

`<swiper>`添加

```vue
v-if="list.length" // 当list为空数组时值为false不会创建<swiper>，只有ajax获取数据完成后才会创建
```

避免在模板里出现逻辑性代码，更优雅的写法：

```vue
v-if="showSwiper"

computed: {
     showSwiper () {
         return this.list.length
     }
}
```

Home.vue

```vue
<template>
    <div class="main-page">
        <home-header></home-header>
        <home-swiper :list="swiperList"></home-swiper>
        <home-icons :list="iconList"></home-icons>
        <home-recommend :list="recommendList"></home-recommend>
        <home-weekend :list="weekendList"></home-weekend>
    </div>    
</template>

<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    import HomeRecommend from './components/Recommend.vue'
    import HomeWeekend from './components/Weekend.vue'
    import axios from 'axios'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend,
            HomeWeekend: HomeWeekend
        },
        data () {
            return {
                swiperList: [],
                iconList: [],
                recommendList: [],
                weekendList: []
            }
        },
        methods: {
            getHomeInfo () {
                axios.get('/api/index.json')
                    .then(this.getHomeInfoSucc)
            },
            getHomeInfoSucc (res) {
                res = res.data
                if (res.ret && res.data) {
                    const data = res.data
                    this.swiperList = data.swiperList
                    this.iconList = data.iconList
                    this.recommendList = data.recommendList
                    this.weekendList = data.weekendList
                }
            }
        },
        mounted () {
            this.getHomeInfo()
        }
    }
</script>

<style lang="stylus">
    .main-page
        position: absolute
        top: 0
        left: 0
        width: 100%
        min-height: 100%
        background: #f5f5f5  
</style>
```

Swiper.vue

```vue
<template>
    <div class="wrapper">
        <swiper :options="swiperOption" v-if="showSwiper">
            <!-- slides -->
            <swiper-slide v-for="item of list" :key="item.id">
                <img  class="swiper-img" :src="item.imgUrl"/>
            </swiper-slide>
            <div class="swiper-pagination"  slot="pagination"></div>
        </swiper>
    </div>
</template>

<script>
    export default {
        name: 'HomeSwiper',
        props: {
            list: Array
        },
        data () {
            return {
                swiperOption: {
                    pagination: '.swiper-pagination',
                    loop: true,
                    autoplay: 5000,
                    observer:true, // 修改swiper自己或子元素时，自动初始化swiper
                    observeParents:true // 修改swiper的父元素时，自动初始化swiper
                }
            }
        },
        computed: {
            showSwiper () {
                return this.list.length
            }
        }
    }
</script>

<style lang="stylus" scoped>
    .wrapper >>> .swiper-pagination-bullet-active
        background: #fff
    .wrapper
        width: 100%
        height: 0
        padding-bottom: 26.7%
        .swiper-img
          width: 100%     
</style>
```

Icons.vue

```vue
<template>
    <div class="icons">
        <swiper :options="swiperOption">
            <swiper-slide v-for="(page, index) of pages" :key="index">
                <div class="icon" v-for="item of page" :key="item.id">
                    <div class="icon-content">
                        <img class="icon-img" :src="item.imgUrl"/>
                        <div class="keyword">{{item.keyword}}</div>   
                    </div>
                </div>
            </swiper-slide>
            <div class="swiper-pagination"  slot="pagination"></div>
        </swiper>                                              
    </div>
</template>

<script>
    export default {
        name: 'HomeIcons',
        props: {
            list: Array
        },
        data () {
            return {
                swiperOption: {
                    pagination: '.swiper-pagination',
                    autoplay: false,
                    observer:true, // 修改swiper自己或子元素时，自动初始化swiper
                           observeParents:true // 修改swiper的父元素时，自动初始化swiper
                }
            }
        },
        computed: {
            pages () {
                const pages = []
                this.list.forEach((item, index) => {
                    const page = Math.floor(index / 8);
                    if (!pages[page]) {
                        pages[page] = []
                    }
                    pages[page].push(item)
                })
                return pages
            }
        }
    }
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'
    @import '~styles/mixins.styl'
    .icons >>> .swiper-pagination-bullet
        width: .12rem
        height: .12rem
        background: rgba(0,175,190,.8)
    .icons >>> .swiper-container-horizontal > .swiper-pagination-bullets
        bottom: .1rem
    .icons >>> .swiper-container
        overflow: hidden
        height: 3.7rem
        padding-top: .1rem
        background-color: #fff
        .icon
            position: relative
            float: left
            width: 25%
            height: 1.5rem
            padding-top : .1rem
            color: $darkColor
            text-align: center  
            .icon-content
                position: absolute
                top: .10rem
                left: 0
                right: 0
                bottom: .44rem
                padding: .1rem
                .icon-img
                    width: 1.1rem
                    height: 1.1rem
                .keyword
                    margin-top: .1rem  
                    ellipsis()                        
</style>
```

Recommend.vue

```vue
<template>
<div class="group">
    <div class="group-title">
        <img class="title-img" alt="猜你喜欢" src="http://img1.qunarzz.com/piao/fusion/1711/89/ebc329f16c55bb02.png"/>
        <span class="title">猜你喜欢</span>
    </div>
    <ul>
        <li class="item border-bottom" v-for="item of list" :key="item.id">
            <img class="item-img" :src="item.imgUrl"/>
            <div class="item-info">
                 <p class="item-title">{{item.title}}</p>
                 <p class="item-desc">{{item.desc}}</p>
                 <button class="item-button">查看详情</button>
            </div>
        </li>
    </ul>
</div>  
</template>

<script>
    export default {
        name: 'HomeRecommend',
        props: {
            list: Array
        }
    }
</script>

<style lang="stylus" scoped>
@import '~styles/mixins.styl'
    .group
        margin-top: .2rem
        background: #fff
        .group-title
            padding: .24rem 0 .26rem
            font-size: .24rem
            .title-img
                width: .3rem
                height: .3rem
                margin-left: .2rem
                overflow: hidden
                vertical-align: top
            .title
                display: inline-block
                color: #212121
                margin-left: .08rem
                font-size: .32rem
                line-height: .44rem              
        .item
            display: flex
            height: 2rem
            padding: .2rem 0
            margin-left: .24rem
            overflow: hidden
        .border-bottom
            border-bottom: 1px solid #e0e0e0     
            .item-img
                width: 2rem
                height: 2rem
            .item-info
                flex: 1
                padding: .1rem
                min-width: 0
                .item-title
                    font-size: .32rem
                    line-height: .54rem
                    ellipsis()
                .item-desc
                    display: inline-block
                    margin-top: .2rem
                    margin-right: .24rem
                    padding: .04rem .1rem
                    line-height: .34rem
                    color: #f55  
                    background: #fff9f9
                    ellipsis()
                .item-button
                    display: block
                    background: #ff9300
                    line-height: .44rem
                    margin-top: .28rem
                    padding: 0 .2rem
                    border-radius: .06rem
                    color: #fff                 
</style>
```

Weekend.vue

```vue
<template>
<div class="group">
    <div>
        <h2 class="weekend-title">周末去哪儿</h2>
    </div>
    <ul class="item">
        <li class="border-bottom" v-for="item of list" :key="item.id">
            <div class="item-imgcontainer">
                <img class="item-img" :src="item.imgUrl"/>
            </div>
            <div class="item-info">
                 <p class="item-name">{{item.title}}</p>
                 <p class="item-desc">{{item.desc}}</p>
            </div>
        </li>
    </ul>
</div>  
</template>

<script>
    export default {
        name: 'HomeWeekend',
        props: {
            list: Array
        }
    }
</script>

<style lang="stylus" scoped>
@import '~styles/mixins.styl'
        .weekend-title
            height: .8rem
            padding-left: .26rem
            line-height : .8rem
            color: #212121
        .item
            background: #fff     
            .item-imgcontainer
                height: 0
                padding-bottom: 37.435%
                overflow: hidden                
                .item-img
                    width: 100%
            .item-info
                padding: .14rem .2rem .2rem .2rem        
                .item-name
                    padding-right: 1.4rem
                    color: #212121
                    font-size: .28rem
                    line-height: .48rem
                    ellipsis()
                .item-desc
                    padding-right: 1.4rem
                    color: #616161
                    font-size: .24rem
                    line-height: .42rem;
                    ellipsis()                 
</style>
```

![3 [9].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746614297-bd4b1dec-20af-470b-b248-a5568769a160.gif)

ctrl + c 退出项目

再次提交

```sh
git add .

git commit -m 'index finish'

git push

git checkout master

git merge origin/index-ajax

git push
```

## 城市列表页

### Vue-Router 简介

![3.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746453385-730f948e-cb3b-465e-ad2d-8f24886b5c41.jpeg)

在`<template>`模板里 以` <router-link>` 方式 跳转到页面

```vue
<router-link to="/demo9">demo9</router-link>

<!-- 下面一行代码表示 跳转到 name 为 demo9 （也可以改为path: '/demo9'）的组件，并且传参数 -->

<router-link :to="{ name: 'demo9', params: { userId: 456 }}">params</router-link> 

<!-- 上面一行代码跳转结果为 http://localhost:8080/#/demo9/456-->

<!-- 下面一行代码表示 跳转到 name 为 demo9 （也可以改为path: '/demo9'）的组件，并且传参数 和 查询参数 -->

<router-link :to="{ name: 'demo9', params: { userId: 456 }, query: { plan: 'private' }}">query</router-link>

<!-- 上面一行代码跳转结果为 http://localhost:8080/#/demo9/456?plan=private -->
```

```js
import demo9 from '@/pages/demo9/index'

Vue.use(Router)

export default new Router({
  routes: [{
      path: '/demo9/:userid', // :表示通配符，userid可以是任何值
      name: 'demo9',
      component: demo9
  }
})
```

JS方式跳转到页面

```vue
<button @click="toURL">跳转页面</button>

export default{
    methods:{
        toURL(){
            // this.$router.push({ path: '/demo8' })
            // this.$router.push({ name: 'demo9', params: { userId: 123 }})
            this.$router.push({ name: 'demo9', params: { userId: 123 }, query: { plan: 'private' } })
        }
    }
}
```

### 页面路由跳转

新建分支为 city-router

```sh
git pull

git checkout city-router 
 
npm run dev
```

打开 src 文件夹下 router 文件夹的 index.js 文件

在 routes 路由项创建一个新的路由，分别配置 路径，路由名，对应的组件

```js
import Vue from 'vue'
import Router from 'vue-router'
import Home from '@/pages/home/Home.vue'
import City from '@/pages/city/City.vue'

Vue.use(Router)

export default new Router({
  routes: [{
      path: '/',
      name: 'Home',
      component: Home
  }, {
      path: '/city',
      name: 'City',
      component: City
  }]
})
```

pages目录下新建city文件夹，city文件夹下创建City.vue文件

![3 [1].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746451609-7394ab42-1695-4dec-8131-81df89af973c.jpeg)

City.vue

```vue
<template>
    <div class="city-page">
        <city-header></city-header>
    </div>   
</template>

<script>
    export default {
        name: 'City'
    }
</script>

<style lang="stylus" scoped>
</style>
```

如何实现点击城市跳转到/city呢？

首页在 Header.vue 使用`<router-link>`

```vue
<router-link to="/city">
    <div class="header-right">
        城市
        <span class="iconfont arrow-icon">&#xe64a;</span>
    </div>
</router-link>
```

![3 [2].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746451618-f37cc260-9f27-4f04-9ce7-35baf06b810f.jpeg)

在 city 文件夹下 新建 components 文件夹，并创建 Header.vue文件

在Header.vue的`<script>`中导出 Header.vue 为 CityHeader 组件

![3 [3].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746451615-8d0f31fb-c90a-4a9a-a529-95253cdf422a.jpeg)

```vue
<template>
    <div class="header">城市选择</div>
</template>

<script>
export default {
    name: 'CityHeader'
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
    .header
        height: .86rem
        line-height: .86rem
        text-align: center
        background: $bgColor  
</style>
```

然后在 City.vue 的`<script>`中引入 Header.vue 为  CityHeader 局部组件

```vue
<template>
    <city-header></city-header>
</template>

<script>
import CityHeader from './components/Header.vue'
export default {
    name: 'City',
    components: {
        CityHeader: CityHeader
    }
}
</script>

<style lang="stylus" scoped>
</style>
```

Header.vue

```vue
<template>
    <div class="header">
        <router-link to="/">
            <div class="iconfont header-back">&#xe624;</div>  
        </router-link>
        <h1 class="header-title">城市选择</h1>
    </div>
</template>

<script>
export default {
    name: 'CityHeader'
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
    .header
        position:relative
        height: .88rem
        background: $bgColor
        color: #fff
        .header-back
            position: absolute
            left: 0
            top: 0
            width: .8rem
            text-align: center
            font-size: .36rem
            line-height: .88rem
            color: #fff            
        .header-title
            margin: 0 1rem
            font-size: .32rem
            text-align: center  
            line-height: .88rem
</style>
```

![3.gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746641923-16d89f59-42d7-4735-b828-764949806df3.gif)

ctrl + c 退出项目

提交代码到仓库

```sh
git add .

git commit -m 'city-router'

git push

git checkout master

git merge city-router

git push
```

### 搜索框布局

新建分支 city-search

```sh
git pull

git checkout city-search

npm run dev
```

components 文件夹 新建组件 Serach.vue

![3 [3].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746451615-8d0f31fb-c90a-4a9a-a529-95253cdf422a.jpeg)

Serach.vue

```vue
<template>
    <div class="search">
        <input class="search-input" type="text" placeholder="输入城市名或拼音"/>
    </div>
</template>

<script>
export default {
    name: 'CitySearch'
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
     .search
         height: .72rem
         padding: 0 .1rem
         background: $bgColor
         .search-input
             box-sizing: border-box
             width: 100%
             height: .62rem
             padding: 0 .1rem
             text-align: center
             border-radius: .06rem
             color: #666
</style>
```

City.vue

```vue
<template>
    <div>
        <city-header></city-header>
        <city-search></city-search>
    </div>   
</template>

<script>
import CityHeader from './components/Header.vue'
import CitySearch from './components/Search.vue'
export default {
    name: 'City',
    components: {
        CityHeader: CityHeader,
        CitySearch: CitySearch
    }
}
</script>

<style lang="stylus" scoped>
</style>
```

![3 [4].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746451619-aaf65f45-a883-4bfa-aa17-54e06fa00d70.jpeg)

ctrl + c 退出项目

提交代码到仓库

```sh
git add .

git commit -m 'add search'

git push

git checkout master

git merge city-search

git push
```

### 列表布局

新建分支 city-list

```sh
git pull

git checkout city-list

npm run dev
```

背景颜色为#f5f5f5

components 文件夹 新建组件 List.vue

Better-scroll的使用和字母表布局

原来去哪儿网的城市列表是利用浏览器自带的滚轮实现的，我们引入更高级的关于区块滚动的内容

```sh
npm install better-scroll --save

npm run start
```

Better-scroll的使用：里面必须有一个包裹多个元素的元素

List.vue

```vue
<template>
    <div class="list" ref="wrapper">
        <div>
            <div class="area">
                <h2 class="title border-topbottom">当前城市</h2>
                <div class="button-list">
                    <div class="button-wrapper">
                        <div class="button">广州</div>
                    </div>
                </div>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">热门城市</h2>
                <div class="button-list">
                    <div class="button-wrapper">
                        <div class="button">广州</div>
                    </div>
                    <div class="button-wrapper">
                        <div class="button">广州</div>
                    </div>
                    <div class="button-wrapper">
                        <div class="button">广州</div>
                    </div>
                </div>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">A</h2>
                <ul class="item-list">
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                </ul>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">A</h2>
                <ul class="item-list">
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                    <li class="item border-bottom">安阳</li>
                </ul>
            </div>
        </div>    
    </div>
</template>

<script>
import Bscroll from 'better-scroll'
export default {
    name: 'CityList',
    mounted () {
        this.scroll = new Bscroll(this.$refs.wrapper)
    }
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
    .border-topbottom
        &:before
            border-color: #ccc
        &:after
            border-color: #ccc
    .border-bottom
        &:before
            border-color: #ccc  
    .list
        overflow: hidden
        position: absolute
        top: 1.58rem
        left: 0
        right:0
        bottom: 0              
    .title
        font-size: .24rem
        padding: .24rem .3rem
        background: #f5f5f5   
        color: #666  
     .button-list
         overflow: hidden
         padding: .1rem .6rem .1rem .1rem
         .button-wrapper
             float: left
             width: 33.33%
             .button
                 margin: .1rem
                 padding: .1rem 0
                 border: .02rem solid #cccccc
                 border-radius: .06rem  
                 text-align: center
     .item-list
         line-height: .76rem
         padding-left: .2rem
</style>
```

components 文件夹 新建组件 Alphabet.vue

```vue
<template>
    <ul class="list">
        <li class="item">A</li>
        <li class="item">A</li>
        <li class="item">A</li>
        <li class="item">A</li>
        <li class="item">A</li>
        <li class="item">A</li>
    </ul>
</template>

<script>
export default {
    name: 'CityAlphabet'
}
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'  
    .list
        display: flex
        flex-direction: column
        justify-content: center
        position: absolute
        top: 1.58rem
        right: 0
        bottom: 0
        width: .4rem
        .item
            line-height: .4rem
            text-align: center
            color: $bgColor                    
</style>
```



![3 [1].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746640916-e61b3370-ea38-4c98-a756-fc65892e0ad8.gif)

ctrl + c 退出项目

再次提交代码到远程仓库

```sh
git add .

git commit -m 'finish city css'

git push

git checkout master

git merge city-list

git push
```

### 页面的动态数据渲染

新建分支 city-ajax，并启动项目

```sh
git pull

git checkout city-ajax

npm run start
```

复制一份 city.json 文件到 static 文件夹下的 mock 文件夹

ajax请求一般放在最外层的组件上，即当前页面，这样一次ajax就可以获得页面所有的请求，所以要在父组件City.vue中实现ajax请求

City.vue

```vue
<template>
    <div>
        <city-header></city-header>
        <city-search></city-search>
        <city-list :cities="cities" :hot="hotCities"></city-list>
        <city-alphabet :cities="cities"></city-alphabet>
    </div>   
</template>

<script>
import axios from 'axios'
import CityHeader from './components/Header.vue'
import CitySearch from './components/Search.vue'
import CityList from './components/List.vue'
import CityAlphabet from './components/Alphabet.vue'
export default {
    name: 'City',
    components: {
        CityHeader: CityHeader,
        CitySearch: CitySearch,
        CityList: CityList,
        CityAlphabet: CityAlphabet
    },
    data () {
        return {
            cities: {},
            hotCities: []    
        }
    },
    methods: {
        getCityInfo () {
            axios.get('/api/city.json')
                .then(this.handelGetCityInfoSucc)
        },
        handelGetCityInfoSucc (res) {
            res = res.data;
            if (res.ret && res.data) {
                const data = res.data
                this.cities = data.cities
                this.hotCities = data.hotCities
            }
        }
    },
    mounted () {
        this.getCityInfo()
    }
}
</script>

<style lang="stylus" scoped>
</style>
```

List.vue

v-for 只需放在要循环显示的元素上，它的子元素自然就会循环显示

双重循环，先循环对象取A B...，再循环数组取item.name  阿坝 阿克苏....

city.json

```json
"cities": {
            "A": [{
                "id": 56,
                "spell": "aba",
                "name": "阿坝"
            }, {
                "id": 57,
                "spell": "akesu",
                "name": "阿克苏"
            }],
            "B": [{
                "id": 1,
                "spell": "beijing",
                "name": "北京"
            }, {
                "id": 66,
                "spell": "baicheng",
                "name": "白城"
            }
}
```

父级循环的 :key 和 子级循环的:key 可以相同，只要父级同层级中的 :key 没有相同的就行

List.vue

```vue
<template>
    <div class="list" ref="wrapper">
        <div>
            <div class="area">
                <h2 class="title border-topbottom">当前城市</h2>
                <div class="button-list">
                    <div class="button-wrapper">
                        <div class="button">广州</div>
                    </div>
                </div>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">热门城市</h2>
                <div class="button-list">
                    <div class="button-wrapper" v-for="item of hot" :key="item.id">
                        <div class="button">{{item.name}}</div>
                    </div>
                </div>
            </div>
            <div class="area" v-for="(item, key) of cities" :key="key">
                <h2 class="title border-topbottom">{{key}}</h2>
                <ul class="item-list" v-for="inneritem of item" :key="inneritem.id">
                    <li class="item border-bottom">{{inneritem.name}}</li>
                </ul>
            </div>
        </div>    
    </div>
</template>

<script>
import Bscroll from 'better-scroll'
export default {
    name: 'CityList',
    props: {
        cities: Object,
        hot: Array
    },
    mounted () {
        this.scroll = new Bscroll(this.$refs.wrapper)
    }
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
    .border-topbottom
        &:before
            border-color: #ccc
        &:after
            border-color: #ccc
    .border-bottom
        &:before
            border-color: #ccc  
    .list
        overflow: hidden
        position: absolute
        top: 1.58rem
        left: 0
        right:0
        bottom: 0              
    .title
        font-size: .24rem
        padding: .24rem .3rem
        background: #f5f5f5   
     .button-list
         overflow: hidden
         padding: .1rem .6rem .1rem .1rem
         .button-wrapper
             float: left
             width: 33.33%
             .button
                 margin: .1rem
                 padding: .1rem 0
                 text-align: center
                 border: .02rem solid #cccccc
                 border-radius: .06rem  
     .item-list
         line-height: .76rem
         padding-left: .2rem
</style>
```

Alphabet.vue

```vue
<template>
    <ul class="list">
        <li class="item" v-for="(item, key) of cities" :key="key">{{key}}</li>
    </ul>
</template>

<script>
export default {
    name: 'CityAlphabet',
    props: {
        cities: Object
    }
}
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'  
    .list
        display: flex
        flex-direction: column
        justify-content: center
        position: absolute
        top: 1.58rem
        right: 0
        bottom: 0
        width: .4rem
        .item
            line-height: .4rem
            text-align: center
            color: $bgColor                    
</style>
```

ctrl + c 退出项目

再次提交代码到远程仓库

```sh
git add .

git commit -m 'ajax city'

git push

git checkout master

git merge city-ajax

git push
```

### 兄弟组件间联动

实现点击字母表跳转到该字母开头的城市列表

把 Alphabet.vue 组件的值 传给 List.vue 组件 ，即兄弟组件之间的传值

因为这个非父子组件传递的兄弟组件只有两个，很简单，所以可以先让 Alphabet.vue 传值给 City.vue，City.vue 再转发给 List.vue

Alphabet.vue

```vue
<template>
    <ul class="list">
        <li
          class="item"
          v-for="(item, key) of cities"
          :key="key"
          @click="handleLetterClick">
            {{key}}
        </li>
    </ul>
</template>

<script>
export default {
    name: 'CityAlphabet',
    props: {
        cities: Object
    },
    methods: {
        handleLetterClick (e) {
             this.$emit('change', e.target.innerText)
        }
    }
}
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'  
    .list
        display: flex
        flex-direction: column
        justify-content: center
        position: absolute
        top: 1.58rem
        right: 0
        bottom: 0
        width: .4rem
        .item
            line-height: .4rem
            text-align: center
            color: $bgColor                    
</style>
```

City.vue

```vue
<template>
    <div class="city-page">
        <city-header></city-header>
        <city-search></city-search>
        <city-list
          :cities="cities"
          :hot="hotCities"
          :letter="letter">
        </city-list>
        <city-alphabet
          :cities="cities"
          @change="handleLetterChange">
        </city-alphabet>
    </div>   
</template>

<script>
import axios from 'axios'
import CityHeader from './components/Header.vue'
import CitySearch from './components/Search.vue'
import CityList from './components/List.vue'
import CityAlphabet from './components/Alphabet.vue'
export default {
    name: 'City',
    components: {
        CityHeader: CityHeader,
        CitySearch: CitySearch,
        CityList: CityList,
        CityAlphabet: CityAlphabet
    },
    data () {
        return {
            cities: {},
            hotCities: [],  
            letter: ''
        }
    },
    methods: {
        getCityInfo () {
            axios.get('/api/city.json')
                .then(this.handelGetCityInfoSucc)
        },
        handelGetCityInfoSucc (res) {
            res = res.data;
            if (res.ret && res.data) {
                const data = res.data
                this.cities = data.cities
                this.hotCities = data.hotCities
            }
        },
        handleLetterChange (letter) {
            this.letter = letter
        }
    },
    mounted () {
        this.getCityInfo()
    }
}
</script>

<style lang="stylus">
</style>
```

实现字母表拖拽

Betterscroll 提供了一个接口 scrollToElement() 让滚动区域自动滚动到某个元素上（当letter数据不为空时滚动到该元素）

```js
scrollToElement(element)
```

使用 ref 绑定 key，key 为A B C D...

```vue
<div
    class="area"
    v-for="(item, key) of cities"
    :key="key"
    :ref="key">
    <h2 class="title border-topbottom">{{key}}</h2>
    <ul class="item-list" v-for="inneritem of item" :key="inneritem.id">
        <li class="item border-bottom">{{inneritem.name}}</li>
    </ul>
</div>
```

![3 [5].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746451626-dd7f82eb-a090-4f92-a405-ddd4f3e8efab.jpeg)

循环输出的 ref 获得的内容是一个数组 [div.area] ，而 scrollToElement() 的参数必须要是一个DOM元素，所以

```js
const element = this.$refs[this.letter][0]
```

List.vue

```vue
<template>
    <div class="list" ref="wrapper">
        <div>
            <div class="area">
                <h2 class="title border-topbottom">当前城市</h2>
                <div class="button-list">
                    <div class="button-wrapper">
                        <div class="button">广州</div>
                    </div>
                </div>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">热门城市</h2>
                <div class="button-list">
                    <div class="button-wrapper" v-for="item of hot" :key="item.id">
                        <div class="button">{{item.name}}</div>
                    </div>
                </div>
            </div>
            <div
              class="area"
              v-for="(item, key) of cities"
              :key="key"
              :ref="key">
                <h2 class="title border-topbottom">{{key}}</h2>
                <ul class="item-list" v-for="inneritem of item" :key="inneritem.id">
                    <li class="item border-bottom">{{inneritem.name}}</li>
                </ul>
            </div>
        </div>    
    </div>
</template>

<script>
import Bscroll from 'better-scroll'
export default {
    name: 'CityList',
    props: {
        cities: Object,
        hot: Array,
        letter: String
    },
    mounted () {
        this.scroll = new Bscroll(this.$refs.wrapper)
    },
    watch: {
        letter () {
            if (this.letter) {
                const element = this.$refs[this.letter][0]
                this.scroll.scrollToElement(element)
            }
        }
    }
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
    .border-topbottom
        &:before
            border-color: #ccc
        &:after
            border-color: #ccc
    .border-bottom
        &:before
            border-color: #ccc  
    .list
        overflow: hidden
        position: absolute
        top: 1.58rem
        left: 0
        right:0
        bottom: 0              
    .title
        font-size: .24rem
        padding: .24rem .3rem
        background: #f5f5f5   
     .button-list
         overflow: hidden
         padding: .1rem .6rem .1rem .1rem
         .button-wrapper
             float: left
             width: 33.33%
             .button
                 margin: .1rem
                 padding: .1rem 0
                 text-align: center
                 border: .02rem solid #cccccc
                 border-radius: .06rem  
     .item-list
         line-height: .76rem
         padding-left: .2rem
</style>
```

![3 [2].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746640790-abdaf929-4ef7-4101-b9c7-c21e03353527.gif)

实现字母表拖拽，列表跟着滚动

首先使用计算属性将 cities 的 key（即A、B、C、D...）取出，放到新数组 letters，即 cities 的 key（即A、B、C、D...） 转接给 letters，v-for 时循环 letters 即可

要监听字母表的滚动事件，需要绑定三个新的事件：touchstart、touchmove、touchend

我们希望只有在 touchstart 之后才能触发 touchmove，所以要在 data 里定义一个标识位

```vue
data () {
    return {
        touchStatus: false
    }
}


handleTouchStart () {
    this.touchStatus = true
},
handleTouchMove (e) {
    if (this.touchStatus) {}
}
```

handleTouchMove要做什么呢？

首先，上下滑动时需要知道当前触碰的是第几个字母

思路：(滑动时当前手指触碰的字母距离页面顶部的高度 - Header头部高度 - 第一个字母A顶部到列表顶部的高度  ) / 每个字母的高度

e.touches[0].clientY 代表 当前手指触摸的字母距离页面顶部的高度 假设当前第一个字母A为 181，即字母 B 顶部距离页面顶部的高度

Header头部高度为 80

this.$refs['A'][0].offsetTop 代表 第一个字母A顶部距离列表顶部的高度，这里是 74

一个字母的高度为 20

所以可以得出公式 Math.floor( (e.touches[0].clientY - 80 - this.$refs['A'][0].offsetTop) / 20 ) 

Math.floor( (181 - 80 - 74) / 20 ) = 1

0 表示 A    Math.floor( (154 - 80 - 74) / 20 ) = 0

1 表示 B    Math.floor( (181 - 80 - 74) / 20 ) = 1

依此类推

![3 [6].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746452390-92f790b5-0292-4562-9a4b-6f852f939fa8.jpeg)

Alphabet.vue

```vue
<template>
    <ul class="list">
        <li
          class="item"
          v-for="item of letters"
          :key="item"
          :ref="item"
          @touchstart="handleTouchStart"
          @touchmove="handleTouchMove"
          @touchend="handleTouchEnd"
          @click="handleClick">
            {{item}}
        </li>
    </ul>
</template>
<script>
export default {
    name: 'CityAlphabet',
    props: {
        cities: Object
    },
    data () {
        return {
            touchStatus: false,
            startY: 0
        }
    },
    computed: {
        letters () {
            const letters = []
            for (let i in this.cities) {
                letters.push(i)
            }
            return letters
        }
    },
    methods: {
        handleClick (e) {
            this.$emit('change', e.target.innerText)
        },
        handleTouchStart () {
            this.touchStatus = true
        },
        handleTouchMove (e) {
            if (this.touchStatus) {
                this.startY = this.$refs['A'][0].offsetTop
                const touchY = e.touches[0].clientY - 80
                const index = Math.floor((touchY - this.startY) / 20)
                if (index >= 0 && index < this.letters.length) {
                    this.$emit('change', this.letters[index])
                }
        },
        handleTouchEnd () {
            this.touchStatus = false
        }
    }
}
</script>
```

### 列表切换性能优化

this.$refs`['A'][0]`.offsetTop A字母的 offsetTop 是固定的

handleTouchMove 性能比较低，因为每执行一次 handleTouchMove 就要运算一次 offsetTop

去掉

```js
const startY = this.$refs['A'][0].offsetTop
```

在 data 里再定义一个初始值 startY

```js
data () {
    return {
        startY: 0
    }
},
updated () {
    this.startY = this.$refs['A'][0].offsetTop
}
```

当初次渲染 Alphabet.vue 时是用 City.vue 的 cities 的数据渲染的，初始化 cities 的值是空对象，

也就是说页面刚加载时 Alphabet.vue里什么东西都不会显示

当 City.vue 的 ajax 获取到数据之后， cities 的值才发生变化，Alphabet.vue 才被渲染出来

往 Alphabet.vue 传的数据发生变化时，Alphabet.vue 就会重新渲染

Alphabet.vue 重新渲染之后，updated 这个生命周期函数就会被执行，

这时页面已经展示了城市字母列表才去获取 offsetTop，实现渲染之后只需要获取一次 offsetTop

### 函数防抖

当鼠标来回移动时 touchmove 的函数 handleTouchMove 执行频率非常高，

所以要限制执行函数的频率，setTimeout设置延迟多少毫秒执行一次

Alphabet.vue

```vue
<template>
    <ul class="list">
        <li
          class="item"
          v-for="item of letters"
          :key="item"
          :ref="item"
          @touchstart="handleTouchStart"
          @touchmove="handleTouchMove"
          @touchend="handleTouchEnd"
          @click="handleClick">
            {{item}}
        </li>
    </ul>
</template>

<script>
export default {
    name: 'CityAlphabet',
    props: {
        cities: Object
    },
    data () {
        return {
            touchStatus: false,
            startY: 0,
            timer: null
        }
    },
    updated () {
        this.startY = this.$refs['A'][0].offsetTop
    },
    computed: {
        letters () {
            const letters = []
            for (let i in this.cities) {
                letters.push(i)
            }
            return letters
        }
    },
    methods: {
        handleClick (e) {
            this.$emit('change', e.target.innerText)
        },
        handleTouchStart () {
            this.touchStatus = true
        },
        handleTouchMove (e) {
            if (this.touchStatus) {
                if (this.timer) {
                    clearTimeout(this.timer)
                }
                this.timer = setTimeout(() => {
                    const touchY = e.touches[0].clientY - 80
                    const index = Math.floor((touchY - this.startY) / 20)
                    if (index >= 0 && index < this.letters.length) {
                        this.$emit('change', this.letters[index])
                    }
                }, 16)
            }
        },
        handleTouchEnd () {
            this.touchStatus = false
        }
    }
}
</script>

<style lang="stylus" scoped>
    @import '~styles/variables.styl'  
    .list
        display: flex
        flex-direction: column
        justify-content: center
        position: absolute
        top: 1.58rem
        right: 0
        bottom: 0
        width: .4rem
        .item
            line-height: .4rem
            text-align: center
            color: $bgColor                    
</style>
```



![3 [3].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746640860-1cfbd76d-093d-463a-8fd5-b3ac66b36963.gif)

ctrl + c 退出项目

再次提交代码到远程仓库

```sh
git add .

git commit -m 'perfomance'

git push

git checkout master

git merge city-components

git push
```

### 搜索功能

新建分支为 city-search-logic

搜索框初始样式

![3 [7].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746452500-e6cf897f-f41d-47b5-bed8-69b404b65552.jpeg)

问题：搜索的列表特别多时无法滚动

使用Better-scroll来实现局部滚动

```js
mounted () {
    this.scroll = new Bscroll(this.$refs.search)
}
```

city.json

```json
"cities": {
            "A": [{
                "id": 56,
                "spell": "aba",
                "name": "阿坝"
            }, {
                "id": 57,
                "spell": "akesu",
                "name": "阿克苏"
            }],
            "B": [{
                "id": 1,
                "spell": "beijing",
                "name": "北京"
            }, {
                "id": 66,
                "spell": "baicheng",
                "name": "白城"
            }
}
```

Search.vue

```vue
<template>
<div>
    <div class="search">
        <input
          v-model="keyword"
          class="search-input"
          type="text"
          placeholder="输入城市名或拼音"/>
    </div>
    <div class="search-content" ref="search" v-show="keyword"> // v-show 输入关键词显示，没有就不显示
        <ul>
            <li
              class="search-item border-bottom"
              v-for="item of list"
              :key="item.id">
              {{item.name}}
            </li>
            <li class="search-item border-bottom" v-show="hasNoData"> // v-show 搜索结果没有时显示
                没有找到匹配的数据
            </li>
        </ul>
    </div>
</div>
</template>

<script>
import Bscroll from 'better-scroll'
export default {
    name: 'CitySearch',
    props: {
        cities: Object
    },
    data () {
        return {
            keyword: '',
            list: [],
            timer: null
        }
    },
    computed: {
        hasNoData () {
            return !this.list.length
        }
    },
    watch: {
        keyword () {
            if (this.timer) {
                clearTimeout(this.timer)
            }
            if (!this.keyword) {
                this.list = []
                return
            }
            this.timer = setTimeout(() => {
                const result = []
                // 搜索核心代码
                for (let i in this.cities) {
                    this.cities[i].forEach((value) => {
                        if (value.spell.indexOf(this.keyword) > -1 || value.name.indexOf(this.keyword) > -1) {
                            result.push(value)
                        }
                    })
                }
                this.list = result
            }, 100)
        }
    },
    mounted () {
        this.scroll = new Bscroll(this.$refs.search)
    }
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
     .border-bottom
         border-bottom: 1px solid #e0e0e0
     .search
         height: .72rem
         padding: 0 .1rem
         background: $bgColor
         .search-input
             box-sizing: border-box
             width: 100%
             height: .62rem
             padding: 0 .1rem
             line-height: .62rem
             text-align: center
             border-radius: .06rem
             color: #666
     .search-content
         position: absolute
         top: 1.58rem
         left: 0
         right: 0
         bottom: 0
         background: #eee
         z-index: 1
         .search-item
             line-height: .62rem
             padding-left: .2rem
             color: #666   
             background: #fff     
</style>
```

City.vue

```vue
<template>
    <div class="city-page">
        <city-header></city-header>
        <city-search :cities="cities"></city-search>
        <city-list
          :cities="cities"
          :hot="hotCities"
          :letter="letter">
        </city-list>
        <city-alphabet
          :cities="cities"
          @change="handleLetterChange">
        </city-alphabet>
    </div>   
</template>

<script>
import axios from 'axios'
import CityHeader from './components/Header.vue'
import CitySearch from './components/Search.vue'
import CityList from './components/List.vue'
import CityAlphabet from './components/Alphabet.vue'
export default {
    name: 'City',
    components: {
        CityHeader: CityHeader,
        CitySearch: CitySearch,
        CityList: CityList,
        CityAlphabet: CityAlphabet
    },
    data () {
        return {
            cities: {},
            hotCities: [],  
            letter: ''
        }
    },
    methods: {
        getCityInfo () {
            axios.get('/api/city.json')
                .then(this.handelGetCityInfoSucc)
        },
        handelGetCityInfoSucc (res) {
            res = res.data;
            if (res.ret && res.data) {
                const data = res.data
                this.cities = data.cities
                this.hotCities = data.hotCities
            }
        },
        handleLetterChange (letter) {
            this.letter = letter
        }
    },
    mounted () {
        this.getCityInfo()
    }
}
</script>

<style>
</style>
```



![3 [4].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746640800-14af1e52-b414-407c-adb0-ba00b1ca148d.gif)

ctrl + c 退出项目

提交代码到仓库

```sh
git add .

git commit -m 'search finish'

git push

git checkout master

git merge city-search-logic

git push
```

### 使用 Vuex 实现 首页 和 城市选择页面 的数据共享

实现功能：点击城市选择页面列表的城市时，首页的城市会跟着变

但是，由于 City.vue 和 Home.vue 没有共用的父级组件，城市选择页面的数据要传给首页就没办法通过父级组件来传了

虽然可以使用bus，但是依然麻烦

Vue 官方提供了数据框架工具——Vuex

Vuex 的设计理念：当我们各个页面或多个组件数据传值困难时，如果我们把公用数据放在一个公共存储区域存储，一旦某个组件改变公用数据，其他组件能感知到

下图虚线部分就是公用数据存储区域，这个区域可以理解成 store 仓库

![vuex.png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746453666-41b59fca-97d8-45e1-a4b9-f951e27dd55c.png)

store仓库由三部分组成

State：存放所有公用的数据，使用数据调用 State 即可（ {{this.$store.state.city}}）

Actions：如果有异步操作或批量复杂的同步操作，可以放在 Actions 里（并不是必须的，可以略过）

Mutations：放着一个一个同步的对 State 的修改

不能让一个组件直接改变公用的数据，必须走一个流程才能改变公用的数据

流程：

组件先调用 Actions（组件使用 Dispatch 方法来操作 Actions）

Actions 接着调用 Mutations（组件或 Actions 使用 Commit 方法来操作 Mutations）

Mutations 最后改变 State 里的公用数据

当数据发生变化，组件展示的内容相应地发生变化

使用 Vuex 时可以使用 Devtools 来调试代码

在main.js引入vuex不太好，因为vuex要做的文件比较复杂，所以要在src文件夹下单独创建一个store文件夹，

在store文件夹新建一个文件，叫 index.js

![3 [8].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746452607-cd84ecbd-5c16-4fcf-ab53-1309b128b4e1.jpeg)

Vuex是一个插件，Vue使用插件都是通过use()使用的

export default 导出的是 Vuex 创建的 store（仓库）

index.js

```js
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
    state: {
        city: '广州'
    }
})
```

main.js 引入 store

```js
import Vue from 'vue'
import App from './App'
import router from './router'
import fastClick from 'fastclick'
import VueAwesomeSwiper from 'vue-awesome-swiper'
import store from './store'
import 'styles/reset.css'
import 'styles/border.css'
import 'styles/iconfont.css'
import 'swiper/dist/css/swiper.css'

Vue.config.productionTip = false
fastClick.attach(document.body)
Vue.use(VueAwesomeSwiper)

/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  store,
  render: h => h(App)
})
```

怎么使用state里的数据呢？

以前首页 `<city-heade :city="city">` 是由外部传递的，现在不需要了

以前的 :city="city" 是通过 ajax 后端返回的，现在 Home.vue 的 data 和 axios、mock 的 city.json 的 city ；

Home.vue 的 props 的 city 都不需要 通过 ajax 后端返回了

因为 main.js 创建根实例时把 store 传递进去了，

所以 store 会被派发到每个组件里，所以每个组件都可以使用 {{this.$store}} 获取到 store

首页 Header.vue 使用state的公用数据city

```vue
<template>
    <div class="header">
        <div class="header-left">
            <div class="iconfont back-icon">&#xe624;</div>
        </div>
        <div class="header-input">
            <span class="iconfont">&#xe632;</span>
            输入城市/景点/主题
        </div>
        <router-link to="/city">
            <div class="header-right">
                {{this.$store.state.city}}
                <span class="iconfont arrow-icon">&#xe64a;</span>
            </div>
        </router-link>
    </div>
</template>
```

城市列表页的List.vue

```vue
<div class="area">
     <h2 class="title border-topbottom">当前城市</h2>
     <div class="button-list">
     <div class="button-wrapper">
     <div class="button">{{this.$store.state.city}}</div>
</div>
```

如果想改变state，需要怎么做呢？

城市列表页的List.vue

```js
handleCityClick (city) {
    this.$store.dispatch('changeCity', city)  
}
```

store文件夹的index.js

城市列表页的 List.vue 的 handleCityClick 触发 dispatch

```js
this.$store.dispatch('changeCity', city)  
```

派发一个 changeCity 的 actions 并且把city传过去

actions 会接收到 city

actions 是一个对象，对象里都是方法，方法接受两个参数，第一个参数是上下文，第二个参数是传递过来的数据

actions 已经接收到传递过来的 city，需要调用 mutatuions 去改变公用数据

mutatuions是一个对象，

对象里都是方法，方法名是任意的，方法接受两个参数，第一个参数是state指的是公用数据，第二个参数是传递过来的数据

```js
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
    state: {
        city: '广州'
    },
    actions: {
        changeCity (ctx, city) {
            ctx.commit('changeCity', city)
        }
    },
    mutations: {
        changeCity (state, city) {
            state.city = city
        }
    }
})
```

列表页面无法点击切换城市，为什么?

betterScroll创建的区域，最近版本默认是不支持点击的，如果需要点击，创建betterScroll 的时候加一个参数即可：

```
new Bscroll(this.$refs.wrapper, {click: true})
```

城市列表页的 List.vue

```vue
<template>
    <div class="list" ref="wrapper">
        <div>
            <div class="area">
                <h2 class="title border-topbottom">当前城市</h2>
                <div class="button-list">
                    <div class="button-wrapper">
                        <div class="button">{{this.$store.state.city}}</div>
                    </div>
                </div>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">热门城市</h2>
                <div class="button-list">
                    <div
                      class="button-wrapper"
                      v-for="item of hot"
                      :key="item.id"
                      @click="handleCityClick(item.name)">
                        <div class="button">{{item.name}}</div>
                    </div>
                </div>
            </div>
            <div
              class="area"
              v-for="(item, key) of cities"
              :key="key"
              :ref="key">
                <h2 class="title border-topbottom">{{key}}</h2>
                <ul class="item-list" v-for="inneritem of item" :key="inneritem.id">
                    <li class="item border-bottom">{{inneritem.name}}</li>
                </ul>
            </div>
        </div>    
    </div>
</template>

<script>
import Bscroll from 'better-scroll'
export default {
    name: 'CityList',
    props: {
        hot: Array,
        cities: Object,
        letter: String
    },
    methods: {
        handleCityClick (city) {
            this.$store.dispatch('changeCity', city)  
        }
    },    
    watch: {
        letter () {
            if (this.letter) {
                const element = this.$refs[this.letter][0]
                this.scroll.scrollToElement(element)
            }
        }
    },
    mounted () {
        this.scroll = new Bscroll(this.$refs.wrapper, {click: true})
    }
}
</script>
```

首页的Header.vue

```vue
<template>
    <div class="header">
        <div class="header-left">
            <div class="iconfont back-icon">&#xe624;</div>
        </div>
        <div class="header-input">
            <span class="iconfont">&#xe632;</span>
            输入城市/景点/主题
        </div>
        <router-link to="/city">
            <div class="header-right">
                {{this.$store.state.city}}
                <span class="iconfont arrow-icon">&#xe64a;</span>
            </div>
        </router-link>
    </div>
</template>

<script>
    export default {
        name: 'HomeHeader'
    }
</script>
```

因为没有异步操作或批量复杂的同步操作，只是简单的操作，所以可以略过 actions，直接用 commit 调用 mutations

城市列表页的List.vue

```js
handleCityClick (city) {
    this.$store.commit('changeCity', city)  
}
```

store文件夹的index.js

```js
export default new Vuex.Store({
    state: {
        city: '广州'
    },
    mutations: {
        changeCity (state, city) {
            state.city = city
        }
    }
})
```

功能完善：

点击城市列表页的城市列表时改变当前城市的显示

```vue
<ul
     class="item-list"
     v-for="inneritem of item"
     :key="inneritem.id"
     @click="handleCityClick(inneritem.name)">
     <li class="item border-bottom">{{inneritem.name}}</li>
</ul>
```

搜索城市时点击城市也能改变当前城市的显示

```vue
<li
   class="search-item border-bottom"
   v-for="item of list"
   :key="item.id"
   @click="handleCityClick(item.name)">
{{item.name}}
</li>
```

点击城市列表页的城市列表或搜索城市点击城市后都可以跳转到首页

this.$router.push('/') 编程式导航

List.vue 和 Search.vue

```js
methods: {
     handleCityClick (city) {
         this.$store.commit('changeCity', city)
         this.$router.push('/')
     }
}
```

### Vuex 的高级使用 和 localStorage

刷新之后城市又变回原来的'广州'，再次访问应该是上次切换的城市

HTML5提供了localStorage，帮助我们实现类似cookie的功能，做到本地存储，API比cookie简单

为了不让index.js页面变得复杂，所以

index.js

```js
import Vue from 'vue'
import Vuex from 'vuex'
import state from './state.js'
import mutations from './mutations.js'

Vue.use(Vuex)

export default new Vuex.Store({
    state,
    mutations
})
```

在state文件夹下新建mutations.js文件

![3 [9].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746452674-61de6a25-e49a-435c-aede-c88bf065d271.jpeg)

mutations.js

```js
export default {
    changeCity(state, city) {
        state.city = city
        try {
            localStorage.city = city
        }
        catch (e) { }
    }
}
```

为了避免用户关闭了本地存储，使用了隐身模式，localStorage 会抛出异常，代码运行不了，所以要使用 try-catch

在state文件夹下新建state.js文件

![3 [10].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746452868-a432a571-b92f-4004-a52a-6e67096f2c47.jpeg)

state.js

```js
let defaultCity = '广州'
try {
    if (localStorage.city) {
        defaultCity = localStorage.city
    }
}
catch (e) { }

export default {
    city: defaultCity
}
```

mapState 的意思是把 Vuex 的 state数据 映射到这个组件名字为 city的计算属性 中

```js
import { mapState } from 'vuex'
export default {
    name: 'HomeHeader',
    computed: {
        ...mapState(['city'])
    }
}
```

```vue
{{this.$store.state.city}}
```

就可以简化成：

```vue
{{this.city}}
```

Vuex还提供了mapMutations

```js
import { mapMutations } from 'vuex'
...mapMutations('changeCity')
```

这段代码有一个mutation叫 changeCity，我们把这个mutation映射到这个组件名叫changeCity的方法里

```js
this.$store.commit('changeCity', city)
```

就可以简化成：

```js
this.changeCity(city)
```

首页的Header.vue

```vue
<template>
    <div class="header">
        <div class="header-left">
            <div class="iconfont back-icon">&#xe624;</div>
        </div>
        <div class="header-input">
            <span class="iconfont">&#xe632;</span>
            输入城市/景点/主题
        </div>
        <router-link to="/city">
            <div class="header-right">
                {{this.city}}
                <span class="iconfont arrow-icon">&#xe64a;</span>
            </div>
        </router-link>
    </div>
</template>

<script>
    import { mapState } from 'vuex'
    export default {
        name: 'HomeHeader',
        computed: {
            ...mapState(['city'])
        }
    }
</script>
```

城市列表页的List.vue

```vue
<template>
    <div class="list" ref="wrapper">
        <div>
            <div class="area">
                <h2 class="title border-topbottom">当前城市</h2>
                <div class="button-list">
                    <div class="button-wrapper">
                        <div class="button">{{this.city}}</div>
                    </div>
                </div>
            </div>
            <div class="area">
                <h2 class="title border-topbottom">热门城市</h2>
                <div class="button-list">
                    <div
                      class="button-wrapper"
                      v-for="item of hot"
                      :key="item.id"
                      @click="handleCityClick(item.name)">
                        <div class="button">{{item.name}}</div>
                    </div>
                </div>
            </div>
            <div
              class="area"
              v-for="(item, key) of cities"
              :key="key"
              :ref="key">
                <h2 class="title border-topbottom">{{key}}</h2>
                <ul
                  class="item-list"
                  v-for="inneritem of item"
                  :key="inneritem.id"
                 @click="handleCityClick(inneritem.name)">
                    <li class="item border-bottom">{{inneritem.name}}</li>
                </ul>
            </div>
        </div>    
    </div>
</template>

<script>
import Bscroll from 'better-scroll'
import { mapState, mapMutations } from 'vuex'
export default {
    name: 'CityList',
    props: {
        hot: Array,
        cities: Object,
        letter: String
    },
    computed: {
        ...mapState({
            city: 'city'
        })
    },
    methods: {
        handleCityClick (city) {
            this.changeCity(city)
            this.$router.push('/')
        },
        ...mapMutations(['changeCity'])
    },    
    watch: {
        letter () {
            if (this.letter) {
                const element = this.$refs[this.letter][0]
                this.scroll.scrollToElement(element)
            }
        }
    },
    mounted () {
        this.scroll = new Bscroll(this.$refs.wrapper, {click: true})
    }
}
</script>
```

城市列表页的Search.vue

```vue
<template>
<div>
    <div class="search">
        <input
          v-model="keyword"
          class="search-input"
          type="text"
          placeholder="输入城市名或拼音"/>
    </div>
    <div
      class="search-content"
      ref="search"
      v-show="keyword">
        <ul>
            <li
              class="search-item border-bottom"
              v-for="item of list"
              :key="item.id"
              @click="handleCityClick(item.name)">
              {{item.name}}
            </li>
            <li class="search-item border-bottom" v-show="hasNoData">
                没有找到匹配的数据
            </li>
        </ul>
    </div>
</div>
</template>

<script>
import Bscroll from 'better-scroll'
import { mapMutations } from 'vuex'
export default {
    name: 'CitySearch',
    props: {
        cities: Object
    },
    data () {
        return {
            keyword: '',
            list: [],
            timer: null
        }
    },
    methods: {
         handleCityClick (city) {
            this.changeCity(city)
            this.$router.push('/')
        },
        ...mapMutations(['changeCity'])
    },
    computed: {
        hasNoData () {
            return !this.list.length
        }
    },
    watch: {
        keyword () {
            if (this.timer) {
                clearTimeout(this.timer)
            }
            if (!this.keyword) {
                this.list = []
                return
            }
            this.timer = setTimeout(() => {
                const result = []
                for (let i in this.cities) {
                    this.cities[i].forEach((value) => {
                        if (value.spell.indexOf(this.keyword) > -1 ||
                        value.name.indexOf(this.keyword) > -1) {
                            result.push(value)
                        }
                    })
                }
                this.list = result
            }, 100)
        }
    },
    mounted () {
        this.scroll = new Bscroll(this.$refs.search, {click: true})
    }
}
</script>
```

![3 [5].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746640972-ffa21564-19ce-4f6c-ae32-c2da42015dd5.gif)

```sh
git add .

git commit -m 'use vuex'

git push

git checkout master

git merge 'city-vuex'

git push
```

### 使用keep-alive优化网页性能

新建分支为city-keepalive

问题：每次路由切换到Home.vue 或 City.vue时都要在重新渲染时使用生命钩子mounted请求一个json文件

![3 [11].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746452969-e646b712-3218-4c1b-acfe-e9cd590f4b4e.jpeg)

App.vue

```vue
<template>
  <div id="app">
    <keep-alive>
      <router-view/>   
    </keep-alive>   
  </div>
</template>

<script>
export default {
  name: 'App'
}
</script>

<style></style>
```

`<router-view/>`  加载过一次后， `<keep-alive>` 将 `<router-view/>` 中的内容放到内存中，

下一次再进入`<router-view/>` 不需要重新渲染重新执行mounted()生命钩子，只需要在内存里拿以前的内容显示即可

还有个逻辑问题：当城市为桂林时，首页显示的是桂林的内容，当城市为北京时，首页显示的应该是北京的内容，所以城市改变时首页还要重新加载一次ajax请求

使用`<keepalive>`时切换城市不会改变请求参数，但是会多出一个activated()函数可以使用

activated()在首页首次加载时会和mounted()一起执行，重新加载首页时mounted()不会执行，而activated()一定会执行

所以activated()里可以判断重新加载页面时的城市是否和上次加载页面的城市相同，如果不相同则再发一次ajax请求

通过`<keepalive>`新增的activated()函数结合this.lastCity 临时缓存变量实现首页代码性能最优化

Home.vue

```vue
<template>
    <div class="main-page">
        <home-header></home-header>
        <home-swiper :list="swiperList"></home-swiper>
        <home-icons :list="iconList"></home-icons>
        <home-recommend :list="recommendList"></home-recommend>
        <home-weekend :list="weekendList"></home-weekend>
    </div>    
</template>

<script>
    import HomeHearder from './components/Header.vue'
    import HomeSwiper from './components/Swiper.vue'
    import HomeIcons from './components/Icons.vue'
    import HomeRecommend from './components/Recommend.vue'
    import HomeWeekend from './components/Weekend.vue'
    import axios from 'axios'
    import { mapState } from 'vuex'
    export default {
        name: 'Home',
        components: {
            HomeHeader: HomeHearder,
            HomeSwiper: HomeSwiper,
            HomeIcons: HomeIcons,
            HomeRecommend: HomeRecommend,
            HomeWeekend: HomeWeekend
        },
        data () {
            return {
                lastCity: '',
                swiperList: [],
                iconList: [],
                recommendList: [],
                weekendList: []
            }
        },
        computed: {
            ...mapState(['city'])
        },
        methods: {
            getHomeInfo () {
                axios.get('/api/index.json?city=' + this.city)
                    .then(this.getHomeInfoSucc)
            },
            getHomeInfoSucc (res) {
                res = res.data
                if (res.ret && res.data) {
                    const data = res.data
                    this.swiperList = data.swiperList
                    this.iconList = data.iconList
                    this.recommendList = data.recommendList
                    this.weekendList = data.weekendList
                }
            }
        },
        mounted () {
            this.lastCity = this.city
            this.getHomeInfo()
        },
        activated () {
            if (this.lastCity !== this.city) {
                this.lastCity = this.city
                this.getHomeInfo()
            }
        }
    }
</script>
```



![3 [6].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746641773-9bfed004-c87d-45d2-b5da-94bf7c223c23.gif)



```sh
git add .

git commit -m 'finish city page'

git push

git checkout master

git merge city-keepalive

git push
```



## 详情页开发

### 动态路由及Banner布局

新建分支为detail-banner

```sh
cd ./Desktop/travel

git pull

git checkout detail-banner
```

我们希望点击推荐中的一项，比如点击公园进入详情页面

打开home文件夹下的Recommand.vue文件

Recommand.vue

```vue
<router-link tag="li" :to="'/detail/' + item.id" class="item border-bottom" v-for="item of list" :key="item.id">
    <img class="item-img" :src="item.imgUrl"/>
    <div class="item-info">
        <p class="item-title">{{item.title}}</p>
        <p class="item-desc">{{item.desc}}</p>
        <button class="item-button">查看详情</button>
    </div>
</router-link>
```

将`<li>` 改为 `<router-link tag="li">` 表示< router-link>渲染成`<li>`标签，不会渲染成`<a>`标签就没有默认样式了

找到router文件夹下的index.js添加路由项

index.js

```js
export default new Router({
  routes: [{
      path: '/',
      name: 'Home',
      component: Home
  }, {
      path: '/city',
      name: 'City',
      component: City
  }, {
      path: '/detail/:id',
      name: 'Detail',
      component: Detail
  }]
})
```

/detail/:id 就是动态路由，`<router-link>`的 :to="'/detail/' + item.id" ，item.id会传给/detail/:id 的 id变量

router文件夹下的index.js 引入Detail组件

```js
import Vue from 'vue'
import Router from 'vue-router'
import Home from '@/pages/home/Home.vue'
import City from '@/pages/city/City.vue'
import Detail from '@/pages/detail/Detail.vue'
```

![3.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746496756-a2fc9fba-f855-449a-8380-9a7a890942a5.jpeg)

pages文件夹下新建文件夹为detail，在detail文件夹下新建Detail.vue

```vue
<template>
    <div>detail</div>
</template>

<script>
export default {
    name: 'Detail'
}
</script>

<style lang="stylus" scoped>
</style>
```

打开去哪儿网http://piao.qunar.com/touch/

新建compoenents文件夹，再新建Banner.vue

```vue
<template>
    <div>banner</div>
</template>

<script>
export default {
    name: 'DetailBanner'
}
</script>

<style lang="stylus" scoped>
</style>
```

Detail.vue 引入Banner.vue组件 并注册为局部组件

```vue
<template>
    <div>
        <detail-banner></detail-banner>
    </div>
</template>

<script>
import DetailBanner from './components/Banner.vue'
export default {
    name: 'Detail',
    components: {
        DetailBanner
    }
}
</script>
```

Detail.vue

```vue
<template>
    <div class="banner">
        <img class="banner-img" src="//img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_600x330_f4701f0e.jpg"/>
        <div class="banner-info">
            <div class="banner-title">南沙湿地公园</div>
            <div class="banner-icon">
                <span class="iconfont">&#xe647;</span>
                <em class="icon-number">32</em>
            </div>            
        </div>
    </div>
</template>

<script>
export default {
    name: 'DetailBanner'
}
</script>

<style lang="stylus" scoped>
     .banner
         position: relative
         overflow: hidden
         width: 100%
         height: 0
         padding-bottom: 55%
     .banner-img
         width: 100%
     .banner-info
         position: absolute
         left: .2rem
         bottom: .36rem
         color: #fff
         .banner-title
            font-size: .36rem
        .banner-icon
            position: absolute
            bottom: .5rem
            width: 1.2rem
            font-size: .24rem
            line-height: .4rem  
            text-align: center
            border-radius: .2rem           
            background: rgba(0, 0 ,0, .5)
            .iconfont
                font-size: .2rem
</style>
```

替换字体图标时，

在阿里图标库添加至项目并下载到本地后，把新下的下列文件（除iconfont.css）替换src => styles => icontfont文件夹的文件

![3.png](https://cdn.nlark.com/yuque/0/2022/png/1614731/1656746497009-793954bc-4700-4a2f-b191-546cbd098bee.png)

打开新下的iconfont.css，把新的url(base64)替换旧的iconfont.css的url(base64)即可

![3 [1].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746496204-15d8bed8-2744-4981-a750-869e32c4423d.jpeg)

### 公用图片画廊组件拆分

在src目录下创建一个common文件夹存放全局公用的组件，common目录下新建文件夹gallary并创建Gallary.vue

![3 [2].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746496217-78d0181f-f0ce-4a23-acdd-f1f398a18378.jpeg)

```vue
<template>
    <div>gallary</div>
</template>

<script>
export default {
    name: 'CommonGallary'
}
</script>

<style lang="stylus" scoped>
</style>
```

在build目录下的webpack.base.conf.js的alias下创建一个别名：

```js
resolve: {
    extensions: ['.js', '.vue', '.json'],
    alias: {
      '@': resolve('src'),
      'styles': resolve('src/assets/styles'),
      'common': resolve('src/common')
    }
 }
```

重启项目

```sh
ctrl + c

npm run start
```

在Banner.vue中引入Gallary.vue

![3 [3].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746496220-b7c3cf05-8bc9-4729-80ac-f57892c0a5c6.jpeg)

Banner.vue

```vue
<template>
    <div>
        <div class="banner">
            <img class="banner-img" src="//img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_600x330_f4701f0e.jpg"/>
            <div class="banner-info">
                <div class="banner-title">南沙湿地公园</div>
                <div class="banner-icon">
                    <span class="iconfont">&#xe647;</span>
                    <em class="icon-number">32</em>
                </div>            
            </div>
        </div>
        <common-gallary></common-gallary>
    </div>   
</template>

<script>
import CommonGallary from 'common/gallary/Gallary.vue'
export default {
    name: 'DetailBanner',
    components: {
        CommonGallary
    }
}
</script>
```

Gallary.vue

```vue
<template>
    <div class="container" @click="handleGallaryClick">
        <div class="wrapper">
            <swiper :options="swiperOption">
                <swiper-slide v-for="(item,index) of imgs" :key="index"> <!-- 接受父组件传值 -->
                    <img class="gallary-img"
                    :src="item"/>
                </swiper-slide>
                <div class="swiper-pagination"  slot="pagination"></div>
            </swiper>
        </div>
    </div>
</template>

<script>
export default {
    name: 'CommonGallary',
    props: {
        imgs: {
            type: Array,
            default () {
                return []  // 如果Banner.vue不传值，就默认返回空
            }
        }
    },
    data () {
        return {
            swiperOption: {
                pagination: '.swiper-pagination',
                paginationType : 'fraction', // 分页器样式为分式形式
                observeParents: true, // 重新打开时轮播图会无法滚动，Swiper计算宽度会有问题，Swiper需要监视让父子重新渲染
                observer: true 
                // 出现这个问题的原因是当父组件变化的时候，子组件没有办法获取父组件的宽度等信息，这两个配置项的作用就是在父组件或者自身发生变化的时候
                // swiper组件自动会刷新一次。
            }
        }
    },
    methods: {
        handleGallaryClick () {
            this.$emit('close')
        }
    }
}
</script>

<style lang="stylus" scoped>
    .container >>> .swiper-container  /*让swiper-pagination bottom: -1rem生效*/
        overflow: inherit
    .container       
        display: flex
        flex-direction: column
        justify-content: center  
        position: fixed
        left: 0
        right: 0
        top: 0
        bottom: 0
        z-index: 1
        background: #000
    .wrapper   
        width: 100%  
        .gallary-img
            width: 100%
        .swiper-pagination
            color: #fff    
            bottom: -1rem  
</style>
```

Banner.vue

```vue
<template>
    <div>
        <div class="banner" @click="handleClick">
            <img class="banner-img" src="//img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_600x330_f4701f0e.jpg"/>
            <div class="banner-info">
                <div class="banner-title">南沙湿地公园</div>
                <div class="banner-icon">
                    <span class="iconfont">&#xe647;</span>
                    <em class="icon-number">32</em>
                </div>            
            </div>
        </div>
        <common-gallary
        :imgs="imgs"
        v-show="showGallary" 
        @close="handleGallaryClose"></common-gallary>
    </div>   
</template>

<script>
import CommonGallary from 'common/gallary/Gallary.vue'
export default {
    name: 'DetailBanner',
    data () {
        return {
            showGallary: false, // 默认画廊是隐藏的            
            imgs: ['http://img1.qunarzz.com/sight/p0/1507/72/72d087ebb95580c2.img.jpg_r_800x800_3417c021.jpg',
            'http://img1.qunarzz.com/sight/p0/1411/93/4bf4b62f71008cab655a079edc90bdb2.water.jpg_r_800x800_46fdfff2.jpg']
        }
    },
    methods: {
        handleClick () {
             this.showGallary = true
        },
        handleGallaryClose () {
            this.showGallary = false
        }
    },
    components: {
        CommonGallary
    }
}
</script>

<style lang="stylus" scoped>
     .banner
         position: relative
         overflow: hidden
         width: 100%
         height: 0
         padding-bottom: 55%
     .banner-img
         width: 100%
     .banner-info
         position: absolute
         left: .2rem
         bottom: .36rem
         color: #fff
         .banner-title
            font-size: .36rem
        .banner-icon
            position: absolute
            bottom: .5rem
            width: 1.2rem
            font-size: .24rem
            line-height: .4rem  
            text-align: center
            border-radius: .2rem           
            background: rgba(0, 0 ,0, .5)
            .iconfont
                font-size: .2rem
</style>
```

![3.gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746670637-08bf6f5e-dae8-4bb4-9197-2ed9315dd170.gif)

提交代码到远程仓库

```sh
git add .

git commit -m 'banner finish'

git push

git checkout master

git merge 'banner-detail'

git push
```

### 实现header渐隐渐现效果

新建分支为 detail-header

```sh
git pull

git checkout detail-header

npm run dev
```

在pages目录下的detail文件夹下的components文件夹新建 Header.vue

![3 [4].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746496222-ab5ce6c4-1ba9-42e6-aa0f-97aeb4e1759f.jpeg)

Header.vue

```vue
<template>
    <div>
        <div class="header-abs"></div>
        <div class="header-fixed"></div>
    </div>   
</template>
<script>
export default {
    name: 'DetailHeader'
}
</script>

<style lang="stylus" scoped>
     
</style>
```

在pages目录下的detail文件夹下的Deatail.vue中引入

Deatail.vue

```vue
<template>
    <div>
        <detail-banner></detail-banner>
        <detail-header></detail-header>
        <div class="content"></div>
    </div>
</template>

<script>
import DetailBanner from './components/Banner.vue'
import DetailHeader from './components/Header.vue'
export default {
    name: 'Detail',
    components: {
        DetailBanner: DetailBanner,
        DetailHeader: DetailHeader
    }
}
</script>

<style lang="stylus" scoped>
    .content
        height: 50rem /* 要让页面足够长才能够滚动 */
</style>
```

Header.vue

```vue
<template>
    <div>
        <router-link tag="div" to="/" class="header-abs" v-show="showAbs">
             <span class="iconfont header-abs-back">&#xe624;</span>
        </router-link>
        <div class="header-fixed" v-show="!showAbs" :style="opacityStyle">
            <router-link to="/">
                <div class="iconfont header-back">&#xe624;</div>  
            </router-link>
            <h1 class="header-title">南沙湿地公园</h1>
        </div>
    </div>   
</template>

<script>
export default {
    name: 'DetailHeader',
    data () {
        return {
            showAbs: true,
            opacityStyle: {
                opacity: 0
            }
        }       
    },
    methods: {
        handleScroll () {
            const top = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop
            if (top > 40) {
                let opacity = top / 206
                opacity = opacity > 1 ? 1 : opacity
                this.opacityStyle = { opacity: opacity }
                this.showAbs = false
            }
            else {
                this.showAbs = true
            }
        }  
    },
    created () {
        window.addEventListener('scroll', this.handleScroll)
    }
}
</script>

<style lang="stylus" scoped>
@import '~styles/variables.styl'
     .header-abs
         position: absolute
         top: .1rem
         left: .1rem
         width: .72rem
         height: .72rem
         line-height: .72rem
         text-align: center  
         border-radius: .36rem
         background: rgba(0, 0, 0, .5)
         .header-abs-back
             color: #fff
    .header-fixed
        position: fixed
        top: 0
        left: 0
        right: 0
        z-index: 90
        height: .88rem
        background: $bgColor
        color: #fff
        .header-back
            position: absolute
            left: 0
            top: 0
            width: .8rem
            font-size: .36rem
            text-align: center
            line-height: .88rem
            color: #fff            
        .header-title
            margin: 0 1rem
            font-size: .32rem
            line-height: .88rem
            text-align: center     
</style>
```

详情页的Header.vue的header样式借鉴的是城市页面的header样式

![3 [1].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746670352-01a55bad-3e7c-4199-b7ad-cafc1f2050a8.gif)

再次提交代码

```sh
git add .

git commit -m 'header animation'

git push

git checkout master

git merge detail-header

git push
```

### 对全局事件的解绑

很多初学者没有对全局事件进行解绑，会影响其他组件，造成大量bug

keep-alive提供了另一个deactived生命钩子函数，当页面替换成另一个页面时触发，实现全局事件的解绑

```js
created () {
    window.addEventListener('scroll', this.handleScroll)
},
deactivated () {
    window.removeEventListener('scroll', this.handleScroll)
}
```

直接修改提交到master分支并让之前的分支合并

```sh
git add .

git commit -m 'fixed problem'

git push

git checkout detail-header

git merge master

git push
```

### 使用递归组件实现详情页列表

新建分支为 detail-list

在pages目录下的detail文件夹下的components文件夹新建 List.vue

![3 [5].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746496251-cc7404ab-8438-4a0b-b0a3-e78e7bcac16f.jpeg)

发现个问题：

```stylus
.border-bottom::before
    border-bottom: 1px solid #e0e0e0  
```

必须放在样式最下面才有效

List.vue

```vue
<template>
   <div>
        <div class="ticket-group" v-for="(item, index) of list" :key="index">
            <h3 class="ticket-type border-bottom">
                <span class="ticket-icon"></span>
                {{item.title}}
            </h3>
            <h3 v-if="item.children">
                <detail-list :list="item.children"></detail-list>
            </h3>
            <div class="ticker-list">
                <div class="ticket-type-info border-bottom">
                    <h5 class="ticket-type-name">南沙湿地公园成人票</h5>
                    <div class="ticket-type-price">
                        ¥<em class="price-num">38</em>
                        <span class="price-numword">起</span>
                    </div>
                    <div class="ticket-type-extend iconfont">&#xe62d;</div>
                </div>
            </div>   
            <div class="ticker-list">
                <div class="ticket-type-info border-bottom">
                    <h5 class="ticket-type-name">南沙湿地公园成人票</h5>
                    <div class="ticket-type-price">
                        ¥<em class="price-num">38</em>
                        <span class="price-numword">起</span>
                    </div>
                    <div class="ticket-type-extend iconfont">&#xe62d;</div>
                </div>
            </div>
        </div>
   </div>      
</template>

<script>
export default {
    name: 'DetailList',
    props: {
        list: Array
    }
}
</script>

<style lang="stylus" scoped>
    .ticket-group
        position: relative
        margin-bottom: .2rem
        .ticket-type
            overflow: hidden
            height: .88rem
            position: relative
            margin-bottom: -.02rem
            font-size: .32rem
            line-height: .88rem
            padding: 0 .2rem
            background: #fff
            color: #333
            text-indent: .4rem
            .ticket-icon
               display: inline-block
               position: absolute
               width: .36rem
               height: .36rem
               top: .26rem
               left: .2rem
               background: url('http://s.qunarzz.com/piao/image/touch/sight/detail.png') 0 -.45rem no-repeat
               margin-right: .1rem
               background-size: .4rem 3rem
        .ticket-list
              overflow: hidden  
            .ticket-type-info
                position: relative
                margin-bottom: -.02rem
                padding: .24rem .2rem
                background:#fff
            .ticket-type-price, .ticket-type-extend  
                 overflow: hidden
                 position: absolute
                 top: 50%
                 height: .4rem
                 line-height: .4rem   
            .ticket-type-price       
                 right: .46rem
                 font-size: .24rem                 
                 margin-top: -.28rem
                 color: #ff9800  
                 .price-num
                     margin-left: .04rem
                     font-size: .4rem  
                 .price-numword
                     display: inline-block
                     color: #9e9e9e
                     font-size: .24rem
            .ticket-type-extend
                right: .2rem
                margin-top: -.22rem
                color: #bbb
                font-size: .24rem                   
        .border-bottom::before
            border-bottom: 1px solid #e0e0e0     
            left: .2rem       
</style>
```

Detail.vue

```vue
<template>
    <div class="page">
        <detail-banner></detail-banner>
        <detail-header></detail-header>
        <detail-list :list="list"></detail-list>
        <div class="content"></div>
    </div>
</template>

<script>
import DetailBanner from './components/Banner.vue'
import DetailHeader from './components/Header.vue'
import DetailList from './components/List.vue'
export default {
    name: 'Detail',
    components: {
        DetailBanner: DetailBanner,
        DetailHeader: DetailHeader,
        DetailList: DetailList
    },
    data () {
        return {
            list: [{
                title: '单票',
                children: [{
                    title: '成人三馆联票',
                    children: [{
                        title: '成人三馆联票 某某连锁店销售'
                    }]
                }, {
                    title: '成人五馆联票'
                }]
            }, {
                title: '套票'
            }, {
                title: '热销联票'
            }, {
                title: '电子导游'
            }]
        }
    }
}
</script>

<style lang="stylus" scoped>
    .page
        position: absolute
        top: 0
        left: 0
        width: 100%
        min-height: 100%
        background: #f5f5f5
        .content
            height: 10rem
</style>
```

![3 [2].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746670484-ee01f7f4-d303-42bc-89fa-4c8352b7f948.gif)

再次提交代码

```sh
git add .

git commit -m 'partially completed'

git push

git checkout master

git merge detail-list

git push
```

### 使用Ajax获取动态数据

新建分支为 detail-ajax

```sh
git pull

git checkout detail-ajax

npm run start
```

detail.json

```json
{
    "ret": true,
    "data": {
        "sightName": "大连圣亚海洋世界(AAAA景区)",
        "bannerImg": "http://img1.qunarzz.com/sight/p0/201404/23/04b92c99462687fa1ba45c1b5ba4ad77.jpg_600x330_bf9c4904.jpg",
        "gallaryImgs": [
            "http://img1.qunarzz.com/sight/p0/201404/23/04b92c99462687fa1ba45c1b5ba4ad77.jpg_800x800_70debc93.jpg",
            "http://img1.qunarzz.com/sight/p0/1709/76/7691528bc7d7ad3ca3.img.png_800x800_9ef05ee7.png"
        ],
        "categoryList": [
            {
                "title": "成人票",
                "children": [
                    {
                        "title": "成人三馆联票",
                        "children": [
                            {
                                "title": "成人三馆联票 - 某一连锁店销售"
                            }
                        ]
                    },
                    {
                        "title": "成人五馆联票"
                    }
                ]
            },
            {
                "title": "学生票"
            },
            {
                "title": "儿童票"
            },
            {
                "title": "特惠票"
            }
        ]
    }
}
```

借助生命周期钩子发ajax请求

当访问ID是001的页面时，应该把ID发给后端，再请求ID对应的JSON数据，如何获得路由的参数呢？

Detail.vue

```vue
<template>
    <div class="page">
        <detail-banner
        :sightName="sightName"
        :bannerImg="bannerImg"
        :gallaryImgs="gallaryImgs"></detail-banner>
        <detail-header></detail-header>
        <detail-list :list="list"></detail-list>
        <div class="content"></div>
    </div>
</template>

<script>
import DetailBanner from './components/Banner.vue'
import DetailHeader from './components/Header.vue'
import DetailList from './components/List.vue'
import axios from 'axios'
export default {
    name: 'Detail',
    components: {
        DetailBanner: DetailBanner,
        DetailHeader: DetailHeader,
        DetailList: DetailList
    },
    data () {
        return {
            sightName: '',
            bannerImg: '',
            gallaryImgs: [],
            list: []
        }
    },
    methods: {
        getDetailInfo () {
            axios.get('/api/detail.json', {
                params: {
                    id: this.$route.path.id
                }
            }).then(this.handleGetDataSucc);
        },           
        handleGetDataSucc (res) {
            res = res.data
            if (res.ret && res.data) {
                const data = res.data
                this.sightName = data.sightName
                this.bannerImg = data.bannerImg
                this.gallaryImgs = data.gallaryImgs
                this.list = data.categoryList
            }
        }           
    },
    mounted () {
        this.getDetailInfo()
    }
}
</script>

<style lang="stylus" scoped>
    .page
        position: absolute
        top: 0
        left: 0
        width: 100%
        min-height: 100%
        background: #f5f5f5
        .content
            height: 10rem
</style>
```

Banner.vue

```vue
<template>
    <div>
        <div class="banner" @click="handleClick">
            <img class="banner-img" :src="bannerImg"/>
            <div class="banner-info">
                <div class="banner-title">{{this.sightName}}</div>
                <div class="banner-icon">
                    <span class="iconfont">&#xe647;</span>
                    <em class="icon-number">{{this.gallaryImgs.length}}</em>
                </div>            
            </div>
        </div>
        <common-gallary
        :imgs="gallaryImgs"
        v-show="showGallary"
        @close="handleGallaryClose"></common-gallary>
    </div>   
</template>
<script>
import CommonGallary from 'common/gallary/Gallary.vue'
export default {
    name: 'DetailBanner',
    props: {
        sightName: String,
        bannerImg: String,
        gallaryImgs: Array
    },
    data () {
        return {
            showGallary: false
        }
    },
    methods: {
        handleClick () {
             this.showGallary = true
        },
        handleGallaryClose () {
            this.showGallary = false
        }
    },
    components: {
        CommonGallary
    }
}
</script>
<style lang="stylus" scoped>
     .banner
         position: relative
         overflow: hidden
         width: 100%
         height: 0
         padding-bottom: 55%
     .banner-img
         width: 100%
     .banner-info
         position: absolute
         left: .2rem
         bottom: .36rem
         color: #fff
         .banner-title
            position: relative
            z-index: 1
            line-height: .4rem
            color: #fff
            font-size: .36rem
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.70)
        .banner-icon
            position: absolute
            bottom: .5rem
            width: 1.2rem
            font-size: .24rem
            line-height: .4rem  
            text-align: center
            border-radius: .2rem           
            background: rgba(0, 0 ,0, .5)
            .iconfont
                font-size: .2rem
        .banner::after
            content: "\0020"
            display: block
            position: absolute
            bottom: 0
            left: 0
            width: 100%
            min-height: .6rem
            background-color: transparent
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .8))        
</style>
```

keep-alive对页面进行了缓存，要使Detail.vue不被缓存，每次进入Detail详情页都会执行一次mounted()发一次ajax请求

APP.vue

```vue
<keep-alive exclude="Detail">
      <router-view/>   
</keep-alive>
```

router文件夹下的index.js（每次点击进入页面都是在页面顶部）

```js
export default new Router({
  routes: [{
      path: '/',
      name: 'Home',
      component: Home
  }, {
      path: '/city',
      name: 'City',
      component: City
  }, {
      path: '/detail/:id',
      name: 'Detail',
      component: Detail
  }],
  scrollBehavior(to, from, savedPosition) {
      return { x: 0, y: 0 }
  }
})
```

### 在项目中加入基础动画

新建分支 detail-animation分支

在common文件夹下新fadeAnimation文件夹并创建FadeAnimation.vue

FadeAnimation.vue

```vue
<template>
    <transition>
        <slot></slot>
    </transition>
</template>

<script>
export default {
    name: 'Fade',
}
</script>

<style lang="stylus" scoped>
    .v-enter, .v-leave-to
        opacity: 0
    .v-enter-active, .v-leave-active
        transition: opacity  .5s    
</style>
```

Banner.vue

```vue
<template>
    <div>
        <div class="banner" @click="handleClick">
            <img class="banner-img" :src="bannerImg"/>
            <div class="banner-info">
                <div class="banner-title">{{this.sightName}}</div>
                <div class="banner-icon">
                    <span class="iconfont">&#xe647;</span>
                    <em class="icon-number">{{this.gallaryImgs.length}}</em>
                </div>            
            </div>
        </div>
        <fade-animation>
            <common-gallary
            :imgs="gallaryImgs"
            v-show="showGallary"
            @close="handleGallaryClose">
            </common-gallary>
        </fade-animation>        
    </div>   
</template>
<script>
import CommonGallary from 'common/gallary/Gallary.vue'
import FadeAnimation from 'common/fadeAnimation/FadeAnimation.vue'
export default {
    name: 'DetailBanner',
    props: {
        sightName: String,
        bannerImg: String,
        gallaryImgs: Array
    },
    data () {
        return {
            showGallary: false
        }
    },
    methods: {
        handleClick () {
             this.showGallary = true
        },
        handleGallaryClose () {
            this.showGallary = false
        }
    },
    components: {
        CommonGallary,
        FadeAnimation
    }
}
</script>
<style lang="stylus" scoped>
     .banner
         position: relative
         overflow: hidden
         width: 100%
         height: 0
         padding-bottom: 55%
     .banner-img
         width: 100%
     .banner-info
         position: absolute
         left: .2rem
         bottom: .36rem
         color: #fff
         .banner-title
            position: relative
            z-index: 1
            line-height: .4rem
            color: #fff
            font-size: .36rem
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.70)
        .banner-icon
            position: absolute
            bottom: .5rem
            width: 1.2rem
            font-size: .24rem
            line-height: .4rem  
            text-align: center
            border-radius: .2rem           
            background: rgba(0, 0 ,0, .5)
            .iconfont
                font-size: .2rem
        .banner::after
            content: "\0020"
            display: block
            position: absolute
            bottom: 0
            left: 0
            width: 100%
            min-height: .6rem
            background-color: transparent
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .8))        
</style>
```

![3 [3].gif](https://cdn.nlark.com/yuque/0/2022/gif/1614731/1656746671243-9f5f2ef1-0ca1-4dff-b992-4998a2f11551.gif)

## 项目的联调、测试与发布

### 联调

之前开发的数据都是mock模拟的假数据，不是后端返回的真实数据

前后端联调：前端代码编写完毕，后端接口也写好时，前端就需要把模拟的数据干掉，使用后端的数据进行调试

在config文件夹的index.js里修改：

![3.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746557954-ab9affb7-e2cf-47cc-b530-0661bdd2264b.jpeg)

修改proxyable配置项 的target地址为 内网的IP地址 /外网的域名 后端服务器

实现 前端向/api地址的请求 代理转发给 任何一台后端服务器（不需要Fiddler或Charles等抓包代理工具了）

然后重启项目

### 测试

启动命令行，输入命令，获取当前机器的 IP地址

```sh
ipconfig (windows) / ifconfig（Mac）
```

webPack devserver 不支持 使用IP地址 访问

在package.json中修改：

![3 [2].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746554752-58434bc9-6f42-41db-a641-3705f96e2028.jpeg)

在同一个局域网下通过 IP地址 +  npm run dev 的端口 8080/8081 即可访问项目

### 城市列表页的Bug

拖动字母表时拖动的是页面屏幕

Alphabet.vue

![3 [3].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746554756-aeef3a64-d6f9-46f9-b0da-aa50ae69fec2.jpeg)

低版本的安卓手机访问项目可能出现白屏

原因1：手机浏览器不支持Promise

安装 babel-polyfill

```sh
npm install babel-polyfill --save
```

重启项目

原因2：依然白屏的话，是Webpack的devserver 问题 ，打包上线就好了

### Vue 项目的打包上线

第一种打包上线

第一步

cd 到项目

npm run build

第二步

项目会多出一个dist文件夹

![3 [4].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746554755-7fe3f50f-e704-4276-a327-8c636da25a5a.jpeg)

把dist文件夹的内容 index.html 和 static 放到 后台的根路径即可

![3 [5].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746554781-d4ba91b4-9225-44f8-8f39-b4cb245fa659.jpeg)

第二种打包上线

如果后端需要在 /project 路径下显示首页  

首先，config 文件夹下的 index.js 修改如下：

![3 [6].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746555388-732ed796-cc65-4c5b-a8f8-73f3656c1f7e.jpeg)

第二步

cd 到项目

npm run build

第三步

项目会多出一个dist文件夹

![3 [7].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746555431-ad25b391-5b57-43f0-930c-8295e936c0e0.jpeg)

dist文件夹重命名为project 

![3 [8].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746555552-f50ad7ce-7f7d-4f8f-8034-ccfa22719eb6.jpeg)

把project文件夹 放到 后台的根路径即可

![3 [9].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746555612-9836da4b-5fc2-4ad4-b56d-d4b1ae8c7af2.jpeg)

### Vue 的异步组件

打开打包上线后的static文件夹

![3 [10].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746556135-4399e680-3aba-4e23-8b0c-e5b85630861f.jpeg)

.map文件是sourcemap文件，用于开发时作调试

![3 [11].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746556370-559feef9-557d-4f5c-b31d-5f0a888ee221.jpeg)

js文件夹下有用的也只是除了.map文件外的三个js文件

mainifest.js 是webPack打包生成的配置文件

vendor.js 是各页面组件公用的代码

app.js 是各页面的业务逻辑代码




打开后端路径，页面会加载三个js文件

进入首页，app.js会执行所有页面的业务逻辑代码，当 app.js > 1MB，时是必须优化的

我们希望，访问首页只加载首页的业务逻辑代码，不需要加载列表页和详情页的业务逻辑代码，这就是异步加载（按需加载）

![3 [12].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746556402-44d7a8d0-fa63-4e63-9794-c730558cca40.jpeg)

router 文件夹下的 index.js 修改如下即可：

![3 [13].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746556711-f8e54316-026d-4708-9507-e774c17143fb.jpeg)

![3 [14].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746556698-35095a8e-e8ed-421b-b198-79f3a25c4c6f.jpeg)

当 app.js < 1MB时使用异步组件会得不偿失，因为每进入下一个页面就会发一个HTTP请求

其他组件也可以使用异步组件

![3 [15].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746557423-df783922-d698-4d75-a4b4-67182c3de092.jpeg)

访问首页会加载三个js文件，project2.js加载首页，project1加载首页的Header

![3 [16].jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1614731/1656746557958-f451ebf9-5d63-4dc4-b7b1-c056d2aff9b6.jpeg)

## 后续学习指南

学习 Vue 的 自定义指令 和 插件等边缘知识点

学习 Vue-Router 的 命名路由 重定向别名 路由守卫

学习 Vuex 的 项目结构 和 其他插件

学习 服务器端渲染 （工作一年后） => 学习 Vue源码

学习 Webpack 和 Babel



























